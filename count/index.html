<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');

    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --dark-color: #2c3e50;
        --light-bg: #f7f9fc;
        --card-bg: #ffffff;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --border-color: #e0e6ed;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: var(--light-bg);
        color: var(--text-primary);
        line-height: 1.6;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: var(--card-bg);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 40px;
        transition: all 0.3s ease;
    }

    .container:hover {
        box-shadow: var(--shadow-hover);
    }

    .header {
        text-align: center;
        margin-bottom: 40px;
    }

    h1 {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .subtitle {
        color: var(--text-secondary);
        font-size: 16px;
        font-weight: 400;
    }

    .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .toolbar-left {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .toolbar-right {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .mode-btn {
        padding: 8px 16px;
        font-size: 14px;
        border: 2px solid var(--border-color);
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .mode-btn:hover {
        border-color: var(--primary-color);
        transform: translateY(-1px);
    }

    .mode-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .textarea-wrapper {
        position: relative;
        margin-bottom: 30px;
    }

    textarea {
        width: 100%;
        min-height: 400px;
        padding: 20px;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        resize: vertical;
        font-size: 16px;
        font-family: 'Noto Sans JP', sans-serif;
        background-color: var(--card-bg);
        color: var(--text-primary);
        transition: all 0.3s ease;
        line-height: 1.8;
    }

    textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .character-limit-bar {
        position: absolute;
        bottom: -20px;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        overflow: hidden;
        display: none;
    }

    .character-limit-bar.show {
        display: block;
    }

    .character-limit-fill {
        height: 100%;
        background: var(--secondary-color);
        transition: all 0.3s ease;
        border-radius: 2px;
    }

    .character-limit-fill.warning {
        background: var(--warning-color);
    }

    .character-limit-fill.danger {
        background: var(--danger-color);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: var(--light-bg);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);
    }

    .stat-icon {
        font-size: 24px;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 4px;
    }

    .stat-label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .advanced-stats {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .advanced-stats-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .advanced-stats-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
    }

    .stats-table {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: white;
        border-radius: 8px;
        font-size: 14px;
    }

    .stat-item-label {
        color: var(--text-secondary);
    }

    .stat-item-value {
        font-weight: 600;
        color: var(--text-primary);
    }

    .word-frequency {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .frequency-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
        max-height: 200px;
        overflow-y: auto;
    }

    .frequency-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 12px;
        background: white;
        border-radius: 6px;
        font-size: 13px;
    }

    .frequency-word {
        font-weight: 500;
        color: var(--text-primary);
    }

    .frequency-count {
        color: var(--primary-color);
        font-weight: 600;
    }

    .comparison-wrapper {
        margin-bottom: 30px;
    }

    .comparison-container {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .comparison-panel {
        background: var(--light-bg);
        padding: 20px;
        border-radius: 12px;
        border: 2px solid var(--border-color);
    }

    .comparison-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        text-align: center;
    }

    .comparison-textarea {
        width: 100%;
        min-height: 300px;
        padding: 15px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        resize: vertical;
        font-size: 14px;
        font-family: 'Noto Sans JP', sans-serif;
        background-color: white;
        margin-bottom: 15px;
    }

    .comparison-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    .comparison-stats {
        display: flex;
        justify-content: space-around;
        gap: 10px;
        font-size: 13px;
        color: var(--text-secondary);
    }

    .stat-mini strong {
        color: var(--primary-color);
        font-weight: 600;
    }

    .comparison-divider {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .vs-label {
        background: var(--primary-color);
        color: white;
        padding: 10px 20px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 18px;
    }

    .comparison-results {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        text-align: center;
    }

    .comparison-results h3 {
        font-size: 20px;
        margin-bottom: 20px;
        color: var(--text-primary);
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .comparison-item {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 2px solid var(--border-color);
    }

    .comparison-label {
        display: block;
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .comparison-value {
        display: block;
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
    }

    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Noto Sans JP', sans-serif;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .btn-secondary {
        background-color: var(--secondary-color);
        color: white;
    }

    .btn-secondary:hover {
        background-color: #27ae60;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .btn-outline {
        background-color: transparent;
        color: var(--text-primary);
        border: 2px solid var(--border-color);
    }

    .btn-outline:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-2px);
    }

    .settings-panel {
        position: fixed;
        right: -400px;
        top: 0;
        width: 400px;
        height: 100vh;
        background: white;
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
    }

    .settings-panel.open {
        right: 0;
    }

    .settings-header {
        padding: 30px;
        background: var(--primary-color);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .settings-content {
        padding: 30px;
    }

    .setting-group {
        margin-bottom: 25px;
    }

    .setting-group-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .setting-label {
        font-size: 14px;
        color: var(--text-secondary);
    }

    .toggle-switch {
        position: relative;
        width: 50px;
        height: 26px;
        background: var(--border-color);
        border-radius: 13px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .toggle-switch.active {
        background: var(--primary-color);
    }

    .toggle-slider {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: left 0.3s ease;
    }

    .toggle-switch.active .toggle-slider {
        left: 27px;
    }

    .character-limit-input {
        width: 100px;
        padding: 8px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        text-align: center;
        font-size: 14px;
    }

    .export-options {
        display: grid;
        gap: 10px;
    }

    .export-btn {
        padding: 10px;
        background: var(--light-bg);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        text-align: left;
    }

    .export-btn:hover {
        border-color: var(--primary-color);
        background: white;
    }

    .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        padding: 16px 24px;
        background: var(--dark-color);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1001;
        font-size: 14px;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    .reading-time {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-secondary);
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }
        
        h1 {
            font-size: 24px;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .settings-panel {
            width: 100%;
            right: -100%;
        }
        
        .comparison-container {
            grid-template-columns: 1fr;
        }
        
        .comparison-divider {
            margin: 20px 0;
        }
    }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--light-bg);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>
        <span>ğŸ“Š</span>
        æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
      </h1>
      <p class="subtitle">é«˜æ©Ÿèƒ½æ—¥æœ¬èªå¯¾å¿œ - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æãƒ»è©³ç´°çµ±è¨ˆ</p>
    </div>

    <div class="toolbar">
      <div class="toolbar-left">
        <button class="mode-btn active" data-mode="normal">
          <span>ğŸ“</span> é€šå¸¸ãƒ¢ãƒ¼ãƒ‰
        </button>
        <button class="mode-btn" data-mode="comparison">
          <span>ğŸ”„</span> æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
        </button>
        <button class="mode-btn" data-mode="analysis">
          <span>ğŸ“ˆ</span> è©³ç´°åˆ†æ
        </button>
      </div>
      <div class="toolbar-right">
        <div class="reading-time">
          <span>â±ï¸</span>
          <span id="readingTime">èª­äº†æ™‚é–“: 0åˆ†</span>
        </div>
        <button class="btn btn-outline" id="settingsBtn">
          <span>âš™ï¸</span> è¨­å®š
        </button>
      </div>
    </div>

    <div class="textarea-wrapper" id="normalMode">
      <textarea id="input" placeholder="ã“ã“ã«æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...&#10;&#10;ğŸ’¡ ãƒ’ãƒ³ãƒˆ:&#10;â€¢ Ctrl/Cmd + A ã§å…¨é¸æŠ&#10;â€¢ Ctrl/Cmd + Z ã§å…ƒã«æˆ»ã™&#10;â€¢ æ–‡å­—æ•°åˆ¶é™ã‚’è¨­å®šã§æœ‰åŠ¹åŒ–ã§ãã¾ã™"></textarea>
      <div class="character-limit-bar" id="limitBar">
        <div class="character-limit-fill" id="limitFill"></div>
      </div>
    </div>

    <div class="comparison-wrapper" id="comparisonMode" style="display: none;">
      <div class="comparison-container">
        <div class="comparison-panel">
          <h3 class="comparison-title">ãƒ†ã‚­ã‚¹ãƒˆ A</h3>
          <textarea id="inputA" class="comparison-textarea" placeholder="æ¯”è¼ƒã™ã‚‹1ã¤ç›®ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›..."></textarea>
          <div class="comparison-stats">
            <span class="stat-mini">æ–‡å­—æ•°: <strong id="charsA">0</strong></span>
            <span class="stat-mini">èªæ•°: <strong id="wordsA">0</strong></span>
            <span class="stat-mini">è¡Œæ•°: <strong id="linesA">0</strong></span>
          </div>
        </div>
        <div class="comparison-divider">
          <div class="vs-label">VS</div>
        </div>
        <div class="comparison-panel">
          <h3 class="comparison-title">ãƒ†ã‚­ã‚¹ãƒˆ B</h3>
          <textarea id="inputB" class="comparison-textarea" placeholder="æ¯”è¼ƒã™ã‚‹2ã¤ç›®ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›..."></textarea>
          <div class="comparison-stats">
            <span class="stat-mini">æ–‡å­—æ•°: <strong id="charsB">0</strong></span>
            <span class="stat-mini">èªæ•°: <strong id="wordsB">0</strong></span>
            <span class="stat-mini">è¡Œæ•°: <strong id="linesB">0</strong></span>
          </div>
        </div>
      </div>
      <div class="comparison-results" id="comparisonResults">
        <h3>ğŸ“Š æ¯”è¼ƒçµæœ</h3>
        <div class="comparison-grid">
          <div class="comparison-item">
            <span class="comparison-label">æ–‡å­—æ•°ã®å·®</span>
            <span class="comparison-value" id="charDiff">0</span>
          </div>
          <div class="comparison-item">
            <span class="comparison-label">èªæ•°ã®å·®</span>
            <span class="comparison-value" id="wordDiff">0</span>
          </div>
          <div class="comparison-item">
            <span class="comparison-label">å…±é€šèªå¥</span>
            <span class="comparison-value" id="commonWords">0</span>
          </div>
          <div class="comparison-item">
            <span class="comparison-label">é¡ä¼¼åº¦</span>
            <span class="comparison-value" id="similarity">0%</span>
          </div>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-value" id="totalChars">0</div>
        <div class="stat-label">ç·æ–‡å­—æ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸš«</div>
        <div class="stat-value" id="charsNoSpaces">0</div>
        <div class="stat-label">æ–‡å­—æ•°ï¼ˆç©ºç™½é™¤ãï¼‰</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’¬</div>
        <div class="stat-value" id="wordCount">0</div>
        <div class="stat-label">èªæ•°ï¼ˆæ¨å®šï¼‰</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“„</div>
        <div class="stat-value" id="lineCount">0</div>
        <div class="stat-label">è¡Œæ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“‘</div>
        <div class="stat-value" id="paragraphCount">0</div>
        <div class="stat-label">æ®µè½æ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“–</div>
        <div class="stat-value" id="sentenceCount">0</div>
        <div class="stat-label">æ–‡æ•°</div>
      </div>
    </div>

    <div class="advanced-stats" id="advancedStats" style="display: none;">
      <div class="advanced-stats-header">
        <h3 class="advanced-stats-title">ğŸ“Š è©³ç´°çµ±è¨ˆ</h3>
      </div>
      <div class="stats-table">
        <div class="stat-item">
          <span class="stat-item-label">ã²ã‚‰ãŒãª</span>
          <span class="stat-item-value" id="hiraganaCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">ã‚«ã‚¿ã‚«ãƒŠ</span>
          <span class="stat-item-value" id="katakanaCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">æ¼¢å­—</span>
          <span class="stat-item-value" id="kanjiCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">è‹±æ•°å­—</span>
          <span class="stat-item-value" id="alphanumericCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">è¨˜å·</span>
          <span class="stat-item-value" id="symbolCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">çµµæ–‡å­—</span>
          <span class="stat-item-value" id="emojiCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">URLæ•°</span>
          <span class="stat-item-value" id="urlCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°</span>
          <span class="stat-item-value" id="emailCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">æ–‡ç¯€æ•°ï¼ˆæ¨å®šï¼‰</span>
          <span class="stat-item-value" id="phraseCount">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">å¹³å‡æ–‡é•·</span>
          <span class="stat-item-value" id="avgSentenceLength">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">æœ€é•·èªå¥</span>
          <span class="stat-item-value" id="longestWord">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">ç•°ãªã‚Šèªæ•°</span>
          <span class="stat-item-value" id="uniqueWords">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-item-label">èªå½™ã®è±Šå¯Œã•</span>
          <span class="stat-item-value" id="lexicalDiversity">0%</span>
        </div>
      </div>
    </div>

    <div class="word-frequency" id="wordFrequency" style="display: none;">
      <div class="advanced-stats-header">
        <h3 class="advanced-stats-title">ğŸ”¤ èªå¥é »åº¦ï¼ˆä¸Šä½20ä»¶ï¼‰</h3>
      </div>
      <div class="frequency-list" id="frequencyList"></div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" id="copyBtn">
        <span>ğŸ“‹</span> ã‚³ãƒ”ãƒ¼
      </button>
      <button class="btn btn-outline" id="exportBtn">
        <span>ğŸ’¾</span> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      </button>
      <button class="btn btn-outline" id="resetBtn">
        <span>ğŸ”„</span> ãƒªã‚»ãƒƒãƒˆ
      </button>
    </div>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h3>è¨­å®š</h3>
      <button id="closeSettingsBtn" style="background: none; border: none; color: white; cursor: pointer; font-size: 24px;">&times;</button>
    </div>
    <div class="settings-content">
      <div class="setting-group">
        <div class="setting-group-title">è¡¨ç¤ºè¨­å®š</div>
        <div class="setting-item">
          <span class="setting-label">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°</span>
          <div class="toggle-switch active" id="realtimeToggle">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">è©³ç´°çµ±è¨ˆã‚’å¸¸ã«è¡¨ç¤º</span>
          <div class="toggle-switch" id="alwaysShowStats">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">èªå¥é »åº¦ã‚’è¡¨ç¤º</span>
          <div class="toggle-switch" id="showWordFrequency">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-group-title">æ–‡å­—æ•°åˆ¶é™</div>
        <div class="setting-item">
          <span class="setting-label">æ–‡å­—æ•°åˆ¶é™ã‚’æœ‰åŠ¹åŒ–</span>
          <div class="toggle-switch" id="enableLimit">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">åˆ¶é™æ–‡å­—æ•°</span>
          <input type="number" class="character-limit-input" id="charLimit" value="1000" min="1">
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-group-title">èª­äº†æ™‚é–“è¨­å®š</div>
        <div class="setting-item">
          <span class="setting-label">èª­æ›¸é€Ÿåº¦ï¼ˆæ–‡å­—/åˆ†ï¼‰</span>
          <input type="number" class="character-limit-input" id="readingSpeed" value="500" min="100" max="1000">
        </div>
      </div>

      <div class="setting-group">
        <div class="setting-group-title">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
        <div class="export-options">
          <button class="export-btn" id="exportTextBtn">
            <strong>ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</strong><br>
            <small>çµ±è¨ˆæƒ…å ±ä»˜ãã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«</small>
          </button>
          <button class="export-btn" id="exportJSONBtn">
            <strong>ğŸ“Š JSON</strong><br>
            <small>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§åˆ©ç”¨å¯èƒ½ãªå½¢å¼</small>
          </button>
          <button class="export-btn" id="exportCSVBtn">
            <strong>ğŸ“ˆ CSV</strong><br>
            <small>Excelã§é–‹ã‘ã‚‹å½¢å¼</small>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ã‚¹
    class CharacterCounter {
        constructor() {
            this.state = {
                mode: 'normal',
                settings: {
                    realtime: true,
                    alwaysShowStats: false,
                    showWordFrequency: false,
                    enableLimit: false,
                    charLimit: 1000,
                    readingSpeed: 500
                },
                lastAnalysis: null,
                comparisonData: {
                    textA: { chars: 0, words: 0, lines: 0 },
                    textB: { chars: 0, words: 0, lines: 0 }
                }
            };

            this.elements = {
                input: document.getElementById('input'),
                inputA: document.getElementById('inputA'),
                inputB: document.getElementById('inputB'),
                normalMode: document.getElementById('normalMode'),
                comparisonMode: document.getElementById('comparisonMode'),
                totalChars: document.getElementById('totalChars'),
                charsNoSpaces: document.getElementById('charsNoSpaces'),
                wordCount: document.getElementById('wordCount'),
                lineCount: document.getElementById('lineCount'),
                paragraphCount: document.getElementById('paragraphCount'),
                sentenceCount: document.getElementById('sentenceCount'),
                readingTime: document.getElementById('readingTime'),
                advancedStats: document.getElementById('advancedStats'),
                wordFrequency: document.getElementById('wordFrequency'),
                frequencyList: document.getElementById('frequencyList'),
                settingsPanel: document.getElementById('settingsPanel'),
                toast: document.getElementById('toast'),
                limitBar: document.getElementById('limitBar'),
                limitFill: document.getElementById('limitFill')
            };

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.updateStats();
            this.showToast('æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¸ã‚ˆã†ã“ãï¼');
        }

        setupEventListeners() {
            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
            this.elements.input.addEventListener('input', () => {
                if (this.state.settings.realtime) {
                    this.updateStats();
                }
            });

            // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
            if (this.elements.inputA && this.elements.inputB) {
                this.elements.inputA.addEventListener('input', () => {
                    if (this.state.settings.realtime) {
                        this.updateComparisonStats();
                    }
                });
                
                this.elements.inputB.addEventListener('input', () => {
                    if (this.state.settings.realtime) {
                        this.updateComparisonStats();
                    }
                });
            }

            // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    this.setMode(btn.getAttribute('data-mode'));
                });
            });

            // è¨­å®šãƒœã‚¿ãƒ³
            document.getElementById('settingsBtn').addEventListener('click', () => {
                this.elements.settingsPanel.classList.add('open');
            });

            // è¨­å®šã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
            document.getElementById('closeSettingsBtn').addEventListener('click', () => {
                this.elements.settingsPanel.classList.remove('open');
            });

            // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
            document.getElementById('copyBtn').addEventListener('click', () => {
                this.copyText();
            });
            document.getElementById('exportBtn').addEventListener('click', () => {
                this.exportAsText();
            });
            document.getElementById('resetBtn').addEventListener('click', () => {
                this.reset();
            });

            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³
            document.getElementById('exportTextBtn').addEventListener('click', () => {
                this.exportAsText();
            });
            document.getElementById('exportJSONBtn').addEventListener('click', () => {
                this.exportAsJSON();
            });
            document.getElementById('exportCSVBtn').addEventListener('click', () => {
                this.exportAsCSV();
            });

            // è¨­å®šãƒˆã‚°ãƒ«
            this.setupSettingsToggles();

            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'Enter':
                            e.preventDefault();
                            this.updateStats();
                            this.showToast('çµ±è¨ˆã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                            break;
                        case 'd':
                            e.preventDefault();
                            this.setMode('analysis');
                            break;
                    }
                }
            });
        }

        setupSettingsToggles() {
            document.getElementById('realtimeToggle').addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active');
                this.state.settings.realtime = e.currentTarget.classList.contains('active');
                if (this.state.settings.realtime) {
                    this.updateStats();
                }
            });

            document.getElementById('alwaysShowStats').addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active');
                this.state.settings.alwaysShowStats = e.currentTarget.classList.contains('active');
                this.elements.advancedStats.style.display = this.state.settings.alwaysShowStats ? 'block' : 'none';
                if (this.state.settings.alwaysShowStats) {
                    this.updateStats();
                }
            });

            document.getElementById('showWordFrequency').addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active');
                this.state.settings.showWordFrequency = e.currentTarget.classList.contains('active');
                this.elements.wordFrequency.style.display = this.state.settings.showWordFrequency && 
                    (this.state.mode === 'analysis' || this.state.settings.alwaysShowStats) ? 'block' : 'none';
                if (this.state.settings.showWordFrequency) {
                    this.updateStats();
                }
            });

            document.getElementById('enableLimit').addEventListener('click', (e) => {
                e.currentTarget.classList.toggle('active');
                this.state.settings.enableLimit = e.currentTarget.classList.contains('active');
                this.updateStats();
            });

            document.getElementById('charLimit').addEventListener('change', (e) => {
                this.state.settings.charLimit = parseInt(e.target.value) || 1000;
                if (this.state.settings.enableLimit) {
                    this.updateStats();
                }
            });

            document.getElementById('readingSpeed').addEventListener('change', (e) => {
                this.state.settings.readingSpeed = parseInt(e.target.value) || 500;
                this.updateStats();
            });
        }

        // æ—¥æœ¬èªã®å½¢æ…‹ç´ è§£æï¼ˆç°¡æ˜“ç‰ˆï¼‰
        tokenizeJapanese(text) {
            const particles = /[ãŒã®ã‚’ã«ã¸ã¨ã§ã‚„ã‹ã‚‚ã¯ã°ã¦ã§ã‚‚ã‹ã‚‰ã¾ã§ã‚ˆã‚Šã»ã©ãªã©ã ã‘ã—ã‹ã•ãˆã™ã‚‰ã“ããªã‚ŠãŸã‚Šãªã©ã¸ã‚‚ã‘ã‚Œã©ã‚‚ã‘ã‚Œã©ã‘ã©ãŒã—ã‹ã—ã—ã‹ã‚‚ãã‚Œã§ã‚‚ã§ã‚‚ã ãŒãŸã ã—ã‚‚ã£ã¨ã‚‚ã¡ãªã¿ã«ãªãŠã‹ã¤ã¾ãŸã¯ã‚ã‚‹ã„ã¯ãŠã‚ˆã³ãªã‚‰ã³ã«]/g;
            
            const patterns = [
                /[\u30A0-\u30FF]+/g,  // ã‚«ã‚¿ã‚«ãƒŠ
                /[\u3040-\u309F]+/g,  // ã²ã‚‰ãŒãª
                /[\u4E00-\u9FAF]+/g,  // æ¼¢å­—
                /[a-zA-Z]+/g,         // è‹±èª
                /\d+/g                // æ•°å­—
            ];
            
            const tokens = [];
            patterns.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        if (!particles.test(match) && match.length > 0) {
                            tokens.push(match);
                        }
                    });
                }
            });
            
            return tokens;
        }

        // æ—¥æœ¬èªã®æ–‡ç¯€ã‚’æ¨å®š
        estimateJapanesePhrases(text) {
            const phraseBreakers = [
                /[ã€ã€‚ï¼ï¼Ÿ]/g,
                /[ã¯ãŒã‚’ã«ã¸ã¨ã§ã‚„ã‚‚]/g,
                /[ã™ã‚‹ã—ãŸã—ã¦ã—ãªã„]/g,
                /[ã§ã™ã¾ã™ã§ã—ãŸã¾ã—ãŸ]/g,
            ];
            
            let phraseCount = 1;
            phraseBreakers.forEach(pattern => {
                const matches = text.match(pattern);
                if (matches) {
                    phraseCount += matches.length;
                }
            });
            
            return Math.max(1, Math.floor(phraseCount / 2));
        }

        updateStats() {
            const text = this.elements.input.value;
            
            // åŸºæœ¬çµ±è¨ˆ
            const totalChars = text.length;
            const charsNoSpaces = text.replace(/\s/g, '').length;
            
            // æ—¥æœ¬èªåˆ¤å®šã¨èªæ•°è¨ˆç®—
            const hasJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(text);
            let words = [];
            let wordCount = 0;
            
            if (hasJapanese) {
                words = this.tokenizeJapanese(text);
                wordCount = words.length;
            } else {
                words = text.match(/\S+/g) || [];
                wordCount = words.length;
            }
            
            const lines = text ? text.split('\n').length : 0;
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim() !== '').length;
            const sentences = text.match(/[.!?ã€‚ï¼ï¼Ÿ]+/g) || [];
            const sentenceCount = sentences.length || (text.trim() ? 1 : 0);
            
            // UIæ›´æ–°
            this.elements.totalChars.textContent = totalChars.toLocaleString();
            this.elements.charsNoSpaces.textContent = charsNoSpaces.toLocaleString();
            this.elements.wordCount.textContent = wordCount.toLocaleString();
            this.elements.lineCount.textContent = lines.toLocaleString();
            this.elements.paragraphCount.textContent = paragraphs.toLocaleString();
            this.elements.sentenceCount.textContent = sentenceCount.toLocaleString();
            
            // èª­äº†æ™‚é–“
            let readingTime;
            if (hasJapanese) {
                readingTime = Math.ceil(totalChars / this.state.settings.readingSpeed);
            } else {
                readingTime = Math.ceil(wordCount / 200);
            }
            this.elements.readingTime.textContent = `èª­äº†æ™‚é–“: ${readingTime}åˆ†`;
            
            // æ–‡å­—æ•°åˆ¶é™
            if (this.state.settings.enableLimit) {
                this.elements.limitBar.classList.add('show');
                const percentage = (totalChars / this.state.settings.charLimit) * 100;
                this.elements.limitFill.style.width = Math.min(percentage, 100) + '%';
                
                this.elements.limitFill.classList.remove('warning', 'danger');
                if (percentage > 90) {
                    this.elements.limitFill.classList.add('danger');
                } else if (percentage > 70) {
                    this.elements.limitFill.classList.add('warning');
                }
            } else {
                this.elements.limitBar.classList.remove('show');
            }
            
            // è©³ç´°çµ±è¨ˆ
            if (this.state.settings.alwaysShowStats || this.state.mode === 'analysis') {
                this.updateAdvancedStats(text, words, hasJapanese);
            }
            
            // åˆ†æçµæœã‚’ä¿å­˜
            this.state.lastAnalysis = {
                text,
                totalChars,
                charsNoSpaces,
                wordCount,
                lines,
                paragraphs,
                sentenceCount,
                timestamp: new Date().toISOString()
            };
        }

        updateAdvancedStats(text, words, hasJapanese) {
            // æ–‡å­—ç¨®åˆ¥ã‚«ã‚¦ãƒ³ãƒˆ
            const hiragana = (text.match(/[\u3040-\u309F]/g) || []).length;
            const katakana = (text.match(/[\u30A0-\u30FF]/g) || []).length;
            const kanji = (text.match(/[\u4E00-\u9FAF]/g) || []).length;
            const alphanumeric = (text.match(/[a-zA-Z0-9]/g) || []).length;
            const emoji = (text.match(/[\u{1F000}-\u{1F9FF}]|[\u{2600}-\u{26FF}]/gu) || []).length;
            
            // URL ã¨ãƒ¡ãƒ¼ãƒ«
            const urlRegex = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g;
            const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
            const urls = (text.match(urlRegex) || []).length;
            const emails = (text.match(emailRegex) || []).length;
            
            // è¨˜å·
            const symbols = text.replace(/[\w\s\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g, '').length;
            
            // å¹³å‡æ–‡é•·
            const sentences = text.split(/[.!?ã€‚ï¼ï¼Ÿ]+/).filter(s => s.trim());
            const avgSentenceLength = sentences.length > 0 
                ? Math.round(sentences.reduce((sum, s) => sum + s.trim().length, 0) / sentences.length)
                : 0;
            
            // æœ€é•·èªå¥
            const longestWord = words.reduce((longest, word) => 
                word.length > longest.length ? word : longest, '');
            
            // ãƒ¦ãƒ‹ãƒ¼ã‚¯èªæ•°ã¨èªå½™ã®è±Šå¯Œã•
            const uniqueWords = new Set(words.map(w => w.toLowerCase()));
            const lexicalDiversity = words.length > 0 
                ? Math.round((uniqueWords.size / words.length) * 100) 
                : 0;
            
            // UIæ›´æ–°
            document.getElementById('hiraganaCount').textContent = hiragana.toLocaleString();
            document.getElementById('katakanaCount').textContent = katakana.toLocaleString();
            document.getElementById('kanjiCount').textContent = kanji.toLocaleString();
            document.getElementById('alphanumericCount').textContent = alphanumeric.toLocaleString();
            document.getElementById('symbolCount').textContent = symbols.toLocaleString();
            document.getElementById('emojiCount').textContent = emoji.toLocaleString();
            document.getElementById('urlCount').textContent = urls.toLocaleString();
            document.getElementById('emailCount').textContent = emails.toLocaleString();
            document.getElementById('avgSentenceLength').textContent = avgSentenceLength.toLocaleString();
            document.getElementById('longestWord').textContent = longestWord || '-';
            document.getElementById('uniqueWords').textContent = uniqueWords.size.toLocaleString();
            document.getElementById('lexicalDiversity').textContent = lexicalDiversity + '%';
            
            // æ–‡ç¯€æ•°ï¼ˆæ—¥æœ¬èªã®ã¿ï¼‰
            if (hasJapanese) {
                const phraseCount = this.estimateJapanesePhrases(text);
                document.getElementById('phraseCount').textContent = phraseCount.toLocaleString();
            }
            
            // èªå¥é »åº¦
            if (this.state.settings.showWordFrequency && words.length > 0) {
                this.updateWordFrequency(words);
            }
        }

        updateWordFrequency(words) {
            const frequency = {};
            const stopWords = new Set(['ã®', 'ã«', 'ã¯', 'ã‚’', 'ãŸ', 'ãŒ', 'ã§', 'ã¦', 'ã¨', 'ã—', 'ã‚Œ', 'ã•', 'ã‚ã‚‹', 'ã„ã‚‹', 'ã‚‚', 'ã™ã‚‹', 'ã‹ã‚‰', 'ãª', 'ã“ã¨', 'ã¨ã—ã¦', 'ã„', 'ã‚„', 'ãªã©', 'ãªã£', 'ãªã„', 'ã“ã®', 'ãŸã‚', 'ãã®', 'ã‚ã£', 'ã‚ˆã†', 'ã¾ãŸ', 'ã‚‚ã®', 'ã¨ã„ã†', 'ã‚ã‚Š', 'ã¾ã§', 'ã‚‰ã‚Œ', 'ãªã‚‹', 'ã¸', 'ã‹', 'ã ', 'ã“ã‚Œ', 'ã«ã‚ˆã£ã¦', 'ã«ã‚ˆã‚Š', 'ãŠã‚Š', 'ã‚ˆã‚Š', 'ã«ã‚ˆã‚‹', 'ãš', 'ãªã‚Š', 'ã‚‰ã‚Œã‚‹', 'ã«ãŠã„ã¦', 'ã°', 'ãªã‹ã£', 'ãªã', 'ã—ã‹ã—', 'ã«ã¤ã„ã¦', 'ã›', 'ã ã£', 'ãã®å¾Œ', 'ã§ãã‚‹', 'ãã‚Œ', 'ã†', 'ã®ã§', 'ãªãŠ', 'ã®ã¿', 'ã§ã', 'ã', 'ã¤', 'ã«ãŠã‘ã‚‹', 'ãŠã‚ˆã³', 'ã„ã†', 'ã•ã‚‰ã«', 'ã§ã‚‚', 'ã‚‰', 'ãŸã‚Š', 'ãã®ä»–', 'ã«é–¢ã™ã‚‹', 'ãŸã¡', 'ã¾ã™', 'ã‚“', 'ãªã‚‰', 'ã«å¯¾ã—ã¦', 'ç‰¹ã«', 'ã›ã‚‹', 'åŠã³', 'ã“ã‚Œã‚‰', 'ã¨ã', 'ã§ã¯', 'ã«ã¦', 'ã»ã‹', 'ãªãŒã‚‰', 'ã†ã¡', 'ãã—ã¦', 'ã¨ã¨ã‚‚ã«', 'ãŸã ã—', 'ã‹ã¤ã¦', 'ãã‚Œãã‚Œ', 'ã¾ãŸã¯', 'ãŠ', 'ã»ã©', 'ã•ã‚‰ã«ã¯', 'ãªã‘ã‚Œã°', 'ã•ã‚‰ã«', 'ã«ã¤ã„ã¦', 'ã„ã£ãŸ']);
            
            words.forEach(word => {
                const normalized = word.toLowerCase().replace(/[.,!?;:'"]/g, '');
                if (normalized.length > 1 && !stopWords.has(normalized)) {
                    frequency[normalized] = (frequency[normalized] || 0) + 1;
                }
            });
            
            const sorted = Object.entries(frequency)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            this.elements.frequencyList.innerHTML = sorted.map(([word, count]) => `
                <div class="frequency-item">
                    <span class="frequency-word">${word}</span>
                    <span class="frequency-count">${count}</span>
                </div>
            `).join('');
        }

        setMode(mode) {
            this.state.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
            });
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
            if (mode === 'normal') {
                this.elements.normalMode.style.display = 'block';
                this.elements.comparisonMode.style.display = 'none';
                document.querySelector('.stats-grid').style.display = 'grid';
                this.elements.advancedStats.style.display = 'none';
                this.elements.wordFrequency.style.display = 'none';
                this.updateStats();
            } else if (mode === 'comparison') {
                this.elements.normalMode.style.display = 'none';
                this.elements.comparisonMode.style.display = 'block';
                document.querySelector('.stats-grid').style.display = 'none';
                this.elements.advancedStats.style.display = 'none';
                this.elements.wordFrequency.style.display = 'none';
                this.updateComparisonStats();
            } else if (mode === 'analysis') {
                this.elements.normalMode.style.display = 'block';
                this.elements.comparisonMode.style.display = 'none';
                document.querySelector('.stats-grid').style.display = 'grid';
                this.elements.advancedStats.style.display = 'block';
                this.elements.wordFrequency.style.display = this.state.settings.showWordFrequency ? 'block' : 'none';
                this.updateStats();
            }
        }

        updateComparisonStats() {
            const textA = this.elements.inputA.value;
            const textB = this.elements.inputB.value;
            
            // ãƒ†ã‚­ã‚¹ãƒˆAã®çµ±è¨ˆ
            const statsA = this.calculateBasicStats(textA);
            document.getElementById('charsA').textContent = statsA.chars.toLocaleString();
            document.getElementById('wordsA').textContent = statsA.words.toLocaleString();
            document.getElementById('linesA').textContent = statsA.lines.toLocaleString();
            
            // ãƒ†ã‚­ã‚¹ãƒˆBã®çµ±è¨ˆ
            const statsB = this.calculateBasicStats(textB);
            document.getElementById('charsB').textContent = statsB.chars.toLocaleString();
            document.getElementById('wordsB').textContent = statsB.words.toLocaleString();
            document.getElementById('linesB').textContent = statsB.lines.toLocaleString();
            
            // æ¯”è¼ƒçµæœ
            const charDiff = Math.abs(statsA.chars - statsB.chars);
            const wordDiff = Math.abs(statsA.words - statsB.words);
            
            document.getElementById('charDiff').textContent = charDiff.toLocaleString();
            document.getElementById('wordDiff').textContent = wordDiff.toLocaleString();
            
            // å…±é€šèªå¥ã®è¨ˆç®—
            const wordsA = new Set(statsA.wordList.map(w => w.toLowerCase()));
            const wordsB = new Set(statsB.wordList.map(w => w.toLowerCase()));
            const commonWords = [...wordsA].filter(x => wordsB.has(x)).length;
            document.getElementById('commonWords').textContent = commonWords.toLocaleString();
            
            // é¡ä¼¼åº¦ã®è¨ˆç®—ï¼ˆJaccardä¿‚æ•°ï¼‰
            const union = new Set([...wordsA, ...wordsB]);
            const similarity = union.size > 0 ? Math.round((commonWords / union.size) * 100) : 0;
            document.getElementById('similarity').textContent = similarity + '%';
            
            // æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            this.state.comparisonData = {
                textA: statsA,
                textB: statsB,
                commonWords,
                similarity
            };
        }

        calculateBasicStats(text) {
            const chars = text.length;
            const lines = text ? text.split('\n').length : 0;
            
            // æ—¥æœ¬èªåˆ¤å®šã¨èªæ•°è¨ˆç®—
            const hasJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(text);
            let wordList = [];
            
            if (hasJapanese) {
                wordList = this.tokenizeJapanese(text);
            } else {
                wordList = text.match(/\S+/g) || [];
            }
            
            return {
                chars,
                words: wordList.length,
                lines,
                wordList
            };
        }

        copyText() {
            let text = '';
            if (this.state.mode === 'comparison') {
                // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ä¸¡æ–¹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
                text = `ã€ãƒ†ã‚­ã‚¹ãƒˆAã€‘\n${this.elements.inputA.value}\n\nã€ãƒ†ã‚­ã‚¹ãƒˆBã€‘\n${this.elements.inputB.value}`;
            } else {
                text = this.elements.input.value;
            }
            
            if (text) {
                // navigator.clipboard.writeTextã‚’ä½¿ã†
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text)
                        .then(() => {
                            this.showToast('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                        })
                        .catch((err) => {
                            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                            this.fallbackCopy(text);
                        });
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    this.fallbackCopy(text);
                }
            }
        }

        fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                this.showToast('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            } catch (err) {
                this.showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            
            document.body.removeChild(textarea);
        }

        showToast(message, duration = 3000) {
            this.elements.toast.textContent = message;
            this.elements.toast.classList.add('show');
            setTimeout(() => {
                this.elements.toast.classList.remove('show');
            }, duration);
        }

        reset() {
            if (confirm('ã™ã¹ã¦ã®å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                if (this.state.mode === 'comparison') {
                    this.elements.inputA.value = '';
                    this.elements.inputB.value = '';
                    this.updateComparisonStats();
                } else {
                    this.elements.input.value = '';
                    this.updateStats();
                }
                this.showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        }

        getLastAnalysis() {
            return this.state.lastAnalysis;
        }

        exportAsText() {
            const stats = this.getLastAnalysis();
            if (!stats) {
                this.showToast('åˆ†æã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const content = `æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼åˆ†æçµæœ
========================
åˆ†ææ—¥æ™‚: ${new Date(stats.timestamp).toLocaleString()}

ã€åŸºæœ¬çµ±è¨ˆã€‘
ç·æ–‡å­—æ•°: ${stats.totalChars.toLocaleString()}
æ–‡å­—æ•°ï¼ˆç©ºç™½é™¤ãï¼‰: ${stats.charsNoSpaces.toLocaleString()}
å˜èªæ•°: ${stats.wordCount.toLocaleString()}
è¡Œæ•°: ${stats.lines.toLocaleString()}
æ®µè½æ•°: ${stats.paragraphs.toLocaleString()}
æ–‡æ•°: ${stats.sentenceCount.toLocaleString()}

ã€ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹ã€‘
${stats.text}`;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `character_count_${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            this.showToast('ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }

        exportAsJSON() {
            const stats = this.getLastAnalysis();
            if (!stats) {
                this.showToast('åˆ†æã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const blob = new Blob([JSON.stringify(stats, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `character_count_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            this.showToast('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }

        exportAsCSV() {
            const stats = this.getLastAnalysis();
            if (!stats) {
                this.showToast('åˆ†æã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const csv = `é …ç›®,å€¤
åˆ†ææ—¥æ™‚,${new Date(stats.timestamp).toLocaleString()}
ç·æ–‡å­—æ•°,${stats.totalChars}
æ–‡å­—æ•°ï¼ˆç©ºç™½é™¤ãï¼‰,${stats.charsNoSpaces}
å˜èªæ•°,${stats.wordCount}
è¡Œæ•°,${stats.lines}
æ®µè½æ•°,${stats.paragraphs}
æ–‡æ•°,${stats.sentenceCount}`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `character_count_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            this.showToast('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }
    }

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
    const characterCounter = new CharacterCounter();
  </script>
</body>

</html>
