<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¤‡åˆ©ã®åŠ› - ç¿’æ…£ãŒäººç”Ÿã‚’å¤‰ãˆã‚‹</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');

    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --purple-color: #9b59b6;
        --dark-color: #2c3e50;
        --light-bg: #f7f9fc;
        --card-bg: #ffffff;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --border-color: #e0e6ed;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: var(--light-bg);
        color: var(--text-primary);
        line-height: 1.6;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: var(--card-bg);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 40px;
        transition: all 0.3s ease;
    }

    .container:hover {
        box-shadow: var(--shadow-hover);
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
    }

    h1 {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .subtitle {
        color: var(--text-secondary);
        font-size: 16px;
        font-weight: 400;
    }

    .tab-container {
        display: flex;
        justify-content: center;
        gap: 0;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--border-color);
    }

    .tab-btn {
        padding: 15px 30px;
        font-size: 16px;
        border: none;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        position: relative;
    }

    .tab-btn:hover {
        color: var(--primary-color);
    }

    .tab-btn.active {
        color: var(--primary-color);
    }

    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-color);
        border-radius: 3px 3px 0 0;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Atomic Habits Quote Banner */
    .quote-banner {
        background: linear-gradient(135deg, var(--purple-color), var(--primary-color));
        color: white;
        padding: 35px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }

    .quote-banner::before {
        content: '"';
        position: absolute;
        top: -20px;
        left: 20px;
        font-size: 120px;
        opacity: 0.1;
        font-family: Georgia, serif;
    }

    .quote-banner h2 {
        font-size: 22px;
        margin-bottom: 15px;
        line-height: 1.4;
    }

    .quote-banner .quote-source {
        font-size: 14px;
        opacity: 0.9;
        font-style: italic;
    }

    /* Core Concept Section */
    .concept-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .concept-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .concept-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .concept-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    .concept-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .concept-card.positive {
        border-left-color: var(--secondary-color);
    }

    .concept-card.negative {
        border-left-color: var(--danger-color);
    }

    .concept-card.neutral {
        border-left-color: var(--warning-color);
    }

    .concept-card-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }

    .concept-card-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .concept-card-desc {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .concept-card-formula {
        margin-top: 12px;
        padding: 10px;
        background: var(--light-bg);
        border-radius: 6px;
        font-family: 'Monaco', monospace;
        font-size: 13px;
        color: var(--primary-color);
        text-align: center;
    }

    /* Valley of Disappointment */
    .valley-section {
        background: linear-gradient(135deg, rgba(231, 76, 60, 0.05), rgba(155, 89, 182, 0.05));
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        border: 2px solid var(--border-color);
    }

    .valley-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .valley-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: center;
    }

    .valley-text {
        font-size: 15px;
        color: var(--text-secondary);
        line-height: 1.8;
    }

    .valley-text strong {
        color: var(--text-primary);
    }

    .valley-text .highlight {
        background: linear-gradient(transparent 60%, rgba(155, 89, 182, 0.2) 60%);
        padding: 0 2px;
    }

    .valley-chart {
        background: white;
        padding: 20px;
        border-radius: 10px;
        height: 200px;
    }

    /* Input Sections */
    .input-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .input-group {
        background: var(--light-bg);
        padding: 20px;
        border-radius: 12px;
    }

    .input-group-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .slider-field {
        margin-bottom: 20px;
    }

    .slider-field:last-child {
        margin-bottom: 0;
    }

    .slider-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .slider-header label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .slider-value {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 18px;
    }

    .slider-input {
        width: 100%;
        -webkit-appearance: none;
        height: 8px;
        border-radius: 4px;
        background: var(--border-color);
        outline: none;
        transition: all 0.3s ease;
    }

    .slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(52, 152, 219, 0.4);
    }

    .slider-input::-webkit-slider-thumb:hover {
        transform: scale(1.2);
    }

    .input-field {
        margin-bottom: 15px;
    }

    .input-field label {
        display: block;
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 6px;
        font-weight: 500;
    }

    .input-field input,
    .input-field select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        font-family: inherit;
        transition: all 0.3s ease;
        background: white;
    }

    .input-field input:focus,
    .input-field select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .input-with-unit {
        position: relative;
    }

    .input-with-unit input {
        padding-right: 50px;
    }

    .input-unit {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
    }

    /* Habit Scenarios */
    .scenarios-section {
        margin-bottom: 30px;
    }

    .scenarios-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .scenarios-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
    }

    .scenario-btn {
        padding: 18px;
        border: 2px solid var(--border-color);
        background: white;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        position: relative;
        overflow: hidden;
    }

    .scenario-btn:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }

    .scenario-btn.active {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(155, 89, 182, 0.05));
    }

    .scenario-btn.active::after {
        content: 'âœ“';
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .scenario-icon {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .scenario-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
        font-size: 15px;
    }

    .scenario-desc {
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .scenario-result {
        font-size: 13px;
        font-weight: 600;
        padding: 5px 10px;
        border-radius: 5px;
        display: inline-block;
    }

    .scenario-result.positive {
        background: rgba(46, 204, 113, 0.1);
        color: var(--secondary-color);
    }

    .scenario-result.negative {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
    }

    /* Results Grid */
    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .result-card {
        background: var(--light-bg);
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .result-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);
    }

    .result-card.highlight {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(52, 152, 219, 0.1));
        border-color: var(--purple-color);
    }

    .result-card.growth {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
        border-color: var(--secondary-color);
    }

    .result-icon {
        font-size: 32px;
        margin-bottom: 10px;
    }

    .result-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
    }

    .result-card.highlight .result-value {
        color: var(--purple-color);
    }

    .result-card.growth .result-value {
        color: var(--secondary-color);
    }

    .result-label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .result-sub {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 5px;
    }

    /* Chart Section */
    .chart-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chart-container {
        position: relative;
        height: 350px;
        background: white;
        border-radius: 8px;
        padding: 20px;
    }

    .chart-legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-secondary);
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* 4 Laws Section */
    .laws-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(46, 204, 113, 0.05));
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .laws-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        text-align: center;
    }

    .laws-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 15px;
    }

    .law-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .law-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .law-number {
        width: 36px;
        height: 36px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        margin: 0 auto 12px;
    }

    .law-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .law-desc {
        font-size: 13px;
        color: var(--text-secondary);
    }

    /* Insight Section */
    .insight-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(155, 89, 182, 0.05));
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        border-left: 4px solid var(--purple-color);
    }

    .insight-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .insight-list {
        list-style: none;
    }

    .insight-list li {
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .insight-list li:last-child {
        border-bottom: none;
    }

    .insight-list li span:first-child {
        font-size: 20px;
        flex-shrink: 0;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background-color: var(--secondary-color);
        color: white;
    }

    .btn-secondary:hover {
        background-color: #27ae60;
        transform: translateY(-2px);
    }

    .btn-outline {
        background-color: transparent;
        color: var(--text-primary);
        border: 2px solid var(--border-color);
    }

    .btn-outline:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-2px);
    }

    /* Asset Tab Styles */
    .calculate-btn {
        width: 100%;
        padding: 15px 30px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
        font-weight: 600;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
    }

    .table-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .table-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .table-wrapper {
        overflow-x: auto;
        background: white;
        border-radius: 8px;
        max-height: 400px;
        overflow-y: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .data-table th,
    .data-table td {
        padding: 12px 15px;
        text-align: right;
        border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
        background: var(--light-bg);
        font-weight: 600;
        color: var(--text-primary);
        position: sticky;
        top: 0;
        z-index: 1;
    }

    .data-table th:first-child,
    .data-table td:first-child {
        text-align: center;
    }

    .data-table tr:hover {
        background: rgba(52, 152, 219, 0.05);
    }

    .data-table .highlight-row {
        background: rgba(46, 204, 113, 0.1);
    }

    .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        padding: 16px 24px;
        background: var(--dark-color);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1001;
        font-size: 14px;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }

        h1 {
            font-size: 24px;
        }

        .tab-btn {
            padding: 12px 20px;
            font-size: 14px;
        }

        .input-section {
            grid-template-columns: 1fr;
        }

        .results-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .chart-container {
            height: 250px;
        }

        .valley-content {
            grid-template-columns: 1fr;
        }

        .scenarios-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--light-bg);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>
        <span>ğŸ“ˆ</span>
        è¤‡åˆ©ã®åŠ›
      </h1>
      <p class="subtitle">ç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ - Atomic Habits</p>
    </div>

    <div class="tab-container">
      <button class="tab-btn active" data-tab="skill">
        <span>ğŸš€</span> ç¿’æ…£ã®åŠ›
      </button>
      <button class="tab-btn" data-tab="asset">
        <span>ğŸ’°</span> è³‡ç”£é‹ç”¨
      </button>
    </div>

    <!-- ç¿’æ…£ã®åŠ›ã‚¿ãƒ– -->
    <div class="tab-content active" id="skillTab">
      <div class="quote-banner">
        <h2>æ¯æ—¥1%è‰¯ããªã‚Œã°ã€1å¹´å¾Œã«ã¯37å€è‰¯ããªã‚‹ã€‚<br>æ¯æ—¥1%æ‚ªããªã‚Œã°ã€1å¹´å¾Œã«ã¯ã»ã¼ã‚¼ãƒ­ã«ãªã‚‹ã€‚</h2>
        <p class="quote-source">â€” James Clearã€Atomic Habitsã€ã‚ˆã‚Š</p>
      </div>

      <!-- Core Concepts -->
      <div class="concept-section">
        <div class="concept-title">
          <span>ğŸ’¡</span> è¤‡åˆ©åŠ¹æœã®æœ¬è³ª
        </div>
        <div class="concept-grid">
          <div class="concept-card positive">
            <div class="concept-card-icon">ğŸ“ˆ</div>
            <div class="concept-card-title">1%ã®æ”¹å–„ã‚’æ¯æ—¥ç¶šã‘ã‚‹</div>
            <div class="concept-card-desc">å°ã•ãªæ”¹å–„ã¯ç›®ç«‹ãŸãªã„ãŒã€æ™‚é–“ã¨ã¨ã‚‚ã«æŒ‡æ•°é–¢æ•°çš„ã«æˆé•·ã™ã‚‹ã€‚æœ€åˆã¯è¦‹ãˆãªãã¦ã‚‚ã€ã‚„ãŒã¦å¤§ããªå·®ã«ãªã‚‹ã€‚</div>
            <div class="concept-card-formula">1.01^365 = 37.78</div>
          </div>
          <div class="concept-card negative">
            <div class="concept-card-icon">ğŸ“‰</div>
            <div class="concept-card-title">1%ã®æ‚ªåŒ–ã‚’æ¯æ—¥ç¶šã‘ã‚‹</div>
            <div class="concept-card-desc">å°ã•ãªæ‚ªç¿’æ…£ã‚‚è¤‡åˆ©ã§è“„ç©ã™ã‚‹ã€‚æ¯æ—¥å°‘ã—ãšã¤è¡°é€€ã™ã‚Œã°ã€1å¹´å¾Œã«ã¯ã»ã¨ã‚“ã©ä½•ã‚‚æ®‹ã‚‰ãªã„ã€‚</div>
            <div class="concept-card-formula">0.99^365 = 0.03</div>
          </div>
          <div class="concept-card neutral">
            <div class="concept-card-icon">â³</div>
            <div class="concept-card-title">72ã®æ³•å‰‡</div>
            <div class="concept-card-desc">2å€ã«ãªã‚‹ã¾ã§ã®æœŸé–“ã¯ã€72ã‚’æˆé•·ç‡ã§å‰²ã‚Œã°åˆ†ã‹ã‚‹ã€‚1%ãªã‚‰72æ—¥ã€2%ãªã‚‰36æ—¥ã§2å€ã«ãªã‚‹ã€‚</div>
            <div class="concept-card-formula">å€ã«ãªã‚‹æ—¥æ•° = 72 Ã· æˆé•·ç‡(%)</div>
          </div>
        </div>
      </div>

      <!-- Valley of Disappointment -->
      <div class="valley-section">
        <div class="valley-title">
          <span>ğŸ”ï¸</span> å¤±æœ›ã®è°·ï¼ˆValley of Disappointmentï¼‰
        </div>
        <div class="valley-content">
          <div class="valley-text">
            <p><strong>åŠªåŠ›ã®æˆæœã¯ç›´ç·šçš„ã«ç¾ã‚Œãªã„ã€‚</strong></p>
            <p style="margin-top: 12px;">æˆé•·æ›²ç·šã¯æœ€åˆã¯ç·©ã‚„ã‹ã§ã€ã‚ã‚‹æ™‚ç‚¹ã‹ã‚‰æ€¥æ¿€ã«ä¸Šæ˜‡ã™ã‚‹ã€‚å¤šãã®äººã¯ã“ã®<span class="highlight">ã€Œå¤±æœ›ã®è°·ã€</span>ã§è«¦ã‚ã¦ã—ã¾ã†ã€‚</p>
            <p style="margin-top: 12px;">ã‚ãªãŸãŒæœŸå¾…ã™ã‚‹ã®ã¯ç›´ç·šçš„ãªæˆé•·ã ãŒã€å®Ÿéš›ã®æˆé•·ã¯æŒ‡æ•°é–¢æ•°çš„ã€‚<strong>æœ€åˆã®æ•°ãƒ¶æœˆã¯ç›®ã«è¦‹ãˆã‚‹æˆæœãŒãªãã¦ã‚‚ã€ãã‚Œã¯ã€Œæ½œåœ¨èƒ½åŠ›ã®è“„ç©æœŸé–“ã€</strong>ãªã®ã ã€‚</p>
            <p style="margin-top: 12px; padding: 12px; background: white; border-radius: 8px; font-weight: 500;">
              ğŸ¯ ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¹ãƒ«ãƒ¼ã¯ã€çªç„¶ã§ã¯ãªã<strong>è“„ç©ã•ã‚ŒãŸåŠªåŠ›ã®çµæœ</strong>ã¨ã—ã¦è¨ªã‚Œã‚‹
            </p>
          </div>
          <div class="valley-chart">
            <canvas id="valleyChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Scenarios -->
      <div class="scenarios-section">
        <div class="scenarios-title">
          <span>ğŸ­</span> ã‚·ãƒŠãƒªã‚ªã‚’é¸ã‚“ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        </div>
        <div class="scenarios-grid">
          <button class="scenario-btn active" data-preset="daily1">
            <div class="scenario-icon">ğŸ“š</div>
            <div class="scenario-name">æ¯æ—¥1%æˆé•·</div>
            <div class="scenario-desc">æ¯æ—¥å°‘ã—ãšã¤å­¦ç¿’ã‚’ç¶šã‘ã‚‹</div>
            <div class="scenario-result positive">1å¹´å¾Œ: 37.8å€</div>
          </button>
          <button class="scenario-btn" data-preset="daily05">
            <div class="scenario-icon">ğŸ¯</div>
            <div class="scenario-name">æ¯æ—¥0.5%æˆé•·</div>
            <div class="scenario-desc">å¿™ã—ãã¦ã‚‚æœ€ä½é™ç¶šã‘ã‚‹</div>
            <div class="scenario-result positive">1å¹´å¾Œ: 6.2å€</div>
          </button>
          <button class="scenario-btn" data-preset="daily01">
            <div class="scenario-icon">ğŸ¢</div>
            <div class="scenario-name">æ¯æ—¥0.1%æˆé•·</div>
            <div class="scenario-desc">è¶…å°ã•ãªä¸€æ­©ã‚’æ¯æ—¥</div>
            <div class="scenario-result positive">1å¹´å¾Œ: 1.44å€</div>
          </button>
          <button class="scenario-btn" data-preset="decline">
            <div class="scenario-icon">ğŸ“‰</div>
            <div class="scenario-name">æ¯æ—¥1%è¡°é€€</div>
            <div class="scenario-desc">ä½•ã‚‚ã—ãªã„ã¨ã©ã†ãªã‚‹ã‹</div>
            <div class="scenario-result negative">1å¹´å¾Œ: 3%ã«</div>
          </button>
          <button class="scenario-btn" data-preset="weekly">
            <div class="scenario-icon">ğŸ“…</div>
            <div class="scenario-name">é€±1ã§5%æˆé•·</div>
            <div class="scenario-desc">é€±æœ«ã«é›†ä¸­çš„ã«å–ã‚Šçµ„ã‚€</div>
            <div class="scenario-result positive">1å¹´å¾Œ: 12.6å€</div>
          </button>
          <button class="scenario-btn" data-preset="sprint">
            <div class="scenario-icon">ğŸƒ</div>
            <div class="scenario-name">30æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
            <div class="scenario-desc">1ãƒ¶æœˆé›†ä¸­ã§2%æˆé•·</div>
            <div class="scenario-result positive">30æ—¥å¾Œ: 1.81å€</div>
          </button>
        </div>
      </div>

      <!-- Input Section -->
      <div class="input-section">
        <div class="input-group">
          <div class="input-group-title">
            <span>âš¡</span> æˆé•·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>æ—¥ã€…ã®æˆé•·ç‡</label>
              <span class="slider-value" id="skillRateValue">1.0%</span>
            </div>
            <input type="range" class="slider-input" id="skillRate" value="1.0" min="-2" max="5" step="0.1">
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>ç¶™ç¶šæ—¥æ•°</label>
              <span class="slider-value" id="skillDaysValue">365æ—¥</span>
            </div>
            <input type="range" class="slider-input" id="skillDays" value="365" min="1" max="1095" step="1">
          </div>
        </div>

        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ®</span> åˆæœŸè¨­å®š
          </div>
          <div class="input-field">
            <label for="initialSkill">åˆæœŸã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«</label>
            <input type="number" id="initialSkill" value="100" min="1" step="1">
          </div>
          <div class="input-field">
            <label for="skillUnit">å˜ä½ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" id="skillUnit" value="ãƒã‚¤ãƒ³ãƒˆ" placeholder="ä¾‹: ãƒã‚¤ãƒ³ãƒˆã€ãƒ¬ãƒ™ãƒ«ã€ç¿’ç†Ÿåº¦">
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="results-grid" id="skillResults">
        <div class="result-card highlight">
          <div class="result-icon">ğŸ†</div>
          <div class="result-value" id="finalSkill">3,778</div>
          <div class="result-label">æœ€çµ‚ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«</div>
        </div>
        <div class="result-card growth">
          <div class="result-icon">ğŸ“ˆ</div>
          <div class="result-value" id="growthMultiple">37.8x</div>
          <div class="result-label">æˆé•·å€ç‡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ“Š</div>
          <div class="result-value" id="totalGrowth">+3,678</div>
          <div class="result-label">ç·æˆé•·é‡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">â°</div>
          <div class="result-value" id="doublingTime">70æ—¥</div>
          <div class="result-label">2å€ã«ãªã‚‹ã¾ã§</div>
          <div class="result-sub">72ã®æ³•å‰‡</div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-section">
        <div class="chart-title">
          <span>ğŸ“‰</span> æˆé•·æ›²ç·š - è¤‡åˆ© vs ç·šå½¢
        </div>
        <div class="chart-container">
          <canvas id="skillChart"></canvas>
        </div>
        <div class="chart-legend" id="skillLegend">
          <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span>è¤‡åˆ©æˆé•·ï¼ˆå®Ÿéš›ã®æˆé•·ï¼‰</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #bdc3c7;"></div>
            <span>ç·šå½¢æˆé•·ï¼ˆæœŸå¾…ã™ã‚‹æˆé•·ï¼‰</span>
          </div>
        </div>
      </div>

      <!-- 4 Laws of Behavior Change -->
      <div class="laws-section">
        <div class="laws-title">ğŸ”„ è¡Œå‹•å¤‰å®¹ã®4ã¤ã®æ³•å‰‡ï¼ˆAtomic Habitsï¼‰</div>
        <div class="laws-grid">
          <div class="law-card">
            <div class="law-number">1</div>
            <div class="law-title">æ˜ç¢ºã«ã™ã‚‹ï¼ˆMake it Obviousï¼‰</div>
            <div class="law-desc">ç¿’æ…£ã®ãã£ã‹ã‘ã‚’ç›®ã«è¦‹ãˆã‚‹å ´æ‰€ã«ç½®ãã€‚ã„ã¤ãƒ»ã©ã“ã§ãƒ»ä½•ã‚’ã™ã‚‹ã‹å…·ä½“åŒ–ã™ã‚‹ã€‚</div>
          </div>
          <div class="law-card">
            <div class="law-number">2</div>
            <div class="law-title">é­…åŠ›çš„ã«ã™ã‚‹ï¼ˆMake it Attractiveï¼‰</div>
            <div class="law-desc">ã‚„ã‚ŠãŸã„ã“ã¨ã¨çµ„ã¿åˆã‚ã›ã‚‹ã€‚ç¿’æ…£ã‚’æ¥½ã—ã„ã‚‚ã®ã¨çµã³ã¤ã‘ã‚‹ã€‚</div>
          </div>
          <div class="law-card">
            <div class="law-number">3</div>
            <div class="law-title">ç°¡å˜ã«ã™ã‚‹ï¼ˆMake it Easyï¼‰</div>
            <div class="law-desc">2åˆ†ãƒ«ãƒ¼ãƒ«ï¼šã¾ãšã¯2åˆ†ã ã‘ã‚„ã‚‹ã€‚éšœå£ã‚’æ¸›ã‚‰ã—ã€å§‹ã‚ã‚„ã™ãã™ã‚‹ã€‚</div>
          </div>
          <div class="law-card">
            <div class="law-number">4</div>
            <div class="law-title">æº€è¶³ã§ãã‚‹ã‚‚ã®ã«ã™ã‚‹ï¼ˆMake it Satisfyingï¼‰</div>
            <div class="law-desc">å³åº§ã«å ±é…¬ã‚’ä¸ãˆã‚‹ã€‚é€²æ—ã‚’å¯è¦–åŒ–ã—ã¦ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒã™ã‚‹ã€‚</div>
          </div>
        </div>
      </div>

      <!-- Insights -->
      <div class="insight-section">
        <div class="insight-title">
          <span>ğŸ’¡</span> ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
        </div>
        <ul class="insight-list" id="insightList">
          <li><span>ğŸ¯</span> <span>æ¯æ—¥1%ã®æˆé•·ã‚’365æ—¥ç¶šã‘ã‚‹ã¨ã€ç´„37.8å€ã«ãªã‚Šã¾ã™</span></li>
          <li><span>âš ï¸</span> <span>é€†ã«æ¯æ—¥1%è¡°é€€ã™ã‚‹ã¨ã€1å¹´å¾Œã«ã¯åˆæœŸå€¤ã®ç´„3%ã¾ã§è½ã¡ã¾ã™</span></li>
          <li><span>ğŸ”‘</span> <span>é‡è¦ãªã®ã¯ã€Œç¶™ç¶šã€ã€‚ä¸€åº¦ã«ãŸãã•ã‚“ã‚ˆã‚Šã€æ¯æ—¥å°‘ã—ãšã¤ã€‚</span></li>
        </ul>
      </div>

      <div class="action-buttons">
        <button class="btn btn-secondary" id="copySkillResultBtn">
          <span>ğŸ“‹</span> çµæœã‚’ã‚³ãƒ”ãƒ¼
        </button>
        <button class="btn btn-outline" id="resetSkillBtn">
          <span>ğŸ”„</span> ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
    </div>

    <!-- è³‡ç”£é‹ç”¨ã‚¿ãƒ– -->
    <div class="tab-content" id="assetTab">
      <div class="input-section">
        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ’°</span> åˆæœŸæŠ•è³‡
          </div>
          <div class="input-field">
            <label for="principal">å…ƒæœ¬ï¼ˆåˆæœŸæŠ•è³‡é¡ï¼‰</label>
            <div class="input-with-unit">
              <input type="number" id="principal" value="1000000" min="0" step="10000">
              <span class="input-unit">å††</span>
            </div>
          </div>
          <div class="input-field">
            <label for="monthly">æ¯æœˆã®ç©ç«‹é¡</label>
            <div class="input-with-unit">
              <input type="number" id="monthly" value="30000" min="0" step="1000">
              <span class="input-unit">å††</span>
            </div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ“…</span> é‹ç”¨æ¡ä»¶
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>å¹´åˆ©ï¼ˆåˆ©å›ã‚Šï¼‰</label>
              <span class="slider-value" id="assetRateValue">5%</span>
            </div>
            <input type="range" class="slider-input" id="assetRate" value="5" min="0.1" max="15" step="0.1">
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>é‹ç”¨æœŸé–“</label>
              <span class="slider-value" id="assetYearsValue">20å¹´</span>
            </div>
            <input type="range" class="slider-input" id="assetYears" value="20" min="1" max="50" step="1">
          </div>
          <div class="input-field">
            <label for="frequency">è¤‡åˆ©è¨ˆç®—ã®é »åº¦</label>
            <select id="frequency">
              <option value="1">å¹´1å›</option>
              <option value="2">åŠå¹´ã”ã¨ï¼ˆå¹´2å›ï¼‰</option>
              <option value="4">å››åŠæœŸã”ã¨ï¼ˆå¹´4å›ï¼‰</option>
              <option value="12" selected>æ¯æœˆï¼ˆå¹´12å›ï¼‰</option>
            </select>
          </div>
        </div>
      </div>

      <button class="calculate-btn" id="calculateAssetBtn">
        <span>ğŸ“Š</span> ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
      </button>

      <div class="results-grid" id="assetResults">
        <div class="result-card highlight">
          <div class="result-icon">ğŸ’</div>
          <div class="result-value" id="finalAmount">0å††</div>
          <div class="result-label">æœ€çµ‚è³‡ç”£é¡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ’µ</div>
          <div class="result-value" id="totalInvested">0å††</div>
          <div class="result-label">ç·æŠ•è³‡é¡</div>
        </div>
        <div class="result-card growth">
          <div class="result-icon">ğŸ“ˆ</div>
          <div class="result-value" id="totalInterest">0å††</div>
          <div class="result-label">é‹ç”¨ç›Š</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ¯</div>
          <div class="result-value" id="returnRate">0%</div>
          <div class="result-label">åç›Šç‡</div>
        </div>
      </div>

      <div class="chart-section">
        <div class="chart-title">
          <span>ğŸ“‰</span> è³‡ç”£æ¨ç§»ã‚°ãƒ©ãƒ•
        </div>
        <div class="chart-container">
          <canvas id="assetChart"></canvas>
        </div>
        <div class="chart-legend" id="assetLegend">
          <div class="legend-item">
            <div class="legend-color" style="background: #3498db;"></div>
            <span>ç·è³‡ç”£é¡</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #2ecc71;"></div>
            <span>æŠ•è³‡å…ƒæœ¬</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>é‹ç”¨ç›Š</span>
          </div>
        </div>
      </div>

      <div class="table-section">
        <div class="table-title">
          <span>ğŸ“‹ å¹´æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿</span>
          <button class="btn btn-outline" id="exportCsvBtn" style="padding: 8px 16px; font-size: 14px;">
            <span>ğŸ’¾</span> CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </button>
        </div>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>å¹´</th>
                <th>å¹´åˆæ®‹é«˜</th>
                <th>ç©ç«‹é¡</th>
                <th>åˆ©æ¯</th>
                <th>å¹´æœ«æ®‹é«˜</th>
                <th>ç´¯è¨ˆæŠ•è³‡é¡</th>
                <th>ç´¯è¨ˆåˆ©æ¯</th>
              </tr>
            </thead>
            <tbody id="assetTableBody">
            </tbody>
          </table>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-secondary" id="copyAssetResultBtn">
          <span>ğŸ“‹</span> çµæœã‚’ã‚³ãƒ”ãƒ¼
        </button>
        <button class="btn btn-outline" id="resetAssetBtn">
          <span>ğŸ”„</span> ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    class CompoundGrowthApp {
        constructor() {
            this.state = {
                currentTab: 'skill',
                skillChart: null,
                assetChart: null,
                valleyChart: null
            };

            this.init();
        }

        init() {
            this.setupTabListeners();
            this.setupSkillListeners();
            this.setupAssetListeners();
            this.calculateSkillGrowth();
            this.calculateAssetGrowth();
            this.drawValleyChart();
            this.showToast('ç¿’æ…£ã®åŠ›ã‚’å¯è¦–åŒ–ã—ã‚ˆã†ï¼');
        }

        setupTabListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    this.switchTab(tab);
                });
            });
        }

        switchTab(tab) {
            this.state.currentTab = tab;

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tab') === tab);
            });

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.getElementById(tab + 'Tab').classList.add('active');

            if (tab === 'skill') {
                this.calculateSkillGrowth();
                this.drawValleyChart();
            } else {
                this.calculateAssetGrowth();
            }
        }

        setupSkillListeners() {
            const skillRate = document.getElementById('skillRate');
            const skillDays = document.getElementById('skillDays');
            const initialSkill = document.getElementById('initialSkill');
            const skillUnit = document.getElementById('skillUnit');

            skillRate.addEventListener('input', () => {
                document.getElementById('skillRateValue').textContent = skillRate.value + '%';
                this.calculateSkillGrowth();
            });

            skillDays.addEventListener('input', () => {
                document.getElementById('skillDaysValue').textContent = skillDays.value + 'æ—¥';
                this.calculateSkillGrowth();
            });

            initialSkill.addEventListener('input', () => this.calculateSkillGrowth());
            skillUnit.addEventListener('input', () => this.calculateSkillGrowth());

            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    this.applyPreset(btn.getAttribute('data-preset'));
                    document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            document.getElementById('copySkillResultBtn').addEventListener('click', () => this.copySkillResults());
            document.getElementById('resetSkillBtn').addEventListener('click', () => this.resetSkill());
        }

        applyPreset(preset) {
            const presets = {
                'daily1': { rate: 1.0, days: 365 },
                'daily05': { rate: 0.5, days: 365 },
                'daily01': { rate: 0.1, days: 365 },
                'decline': { rate: -1.0, days: 365 },
                'weekly': { rate: 5.0, days: 52 },
                'sprint': { rate: 2.0, days: 30 }
            };

            const p = presets[preset];
            if (p) {
                document.getElementById('skillRate').value = p.rate;
                document.getElementById('skillDays').value = p.days;
                document.getElementById('skillRateValue').textContent = p.rate + '%';
                document.getElementById('skillDaysValue').textContent = p.days + 'æ—¥';
                this.calculateSkillGrowth();
            }
        }

        calculateSkillGrowth() {
            const rate = parseFloat(document.getElementById('skillRate').value) / 100;
            const days = parseInt(document.getElementById('skillDays').value);
            const initial = parseFloat(document.getElementById('initialSkill').value) || 100;

            const finalSkill = initial * Math.pow(1 + rate, days);
            const growthMultiple = finalSkill / initial;
            const totalGrowth = finalSkill - initial;
            const doublingTime = rate > 0 ? Math.ceil(72 / (rate * 100)) : 'âˆ';

            document.getElementById('finalSkill').textContent = this.formatNumber(finalSkill);
            document.getElementById('growthMultiple').textContent = growthMultiple.toFixed(1) + 'x';
            document.getElementById('totalGrowth').textContent = (totalGrowth >= 0 ? '+' : '') + this.formatNumber(totalGrowth);
            document.getElementById('doublingTime').textContent = doublingTime === 'âˆ' ? 'âˆ' : doublingTime + 'æ—¥';

            this.updateInsights(rate, days, growthMultiple);
            this.updateSkillChart(rate, days, initial);
        }

        updateInsights(rate, days, multiple) {
            const insights = [];

            if (rate > 0) {
                insights.push({
                    icon: 'ğŸ¯',
                    text: `æ¯æ—¥${(rate * 100).toFixed(1)}%ã®æˆé•·ã‚’${days}æ—¥ç¶šã‘ã‚‹ã¨ã€ç´„${multiple.toFixed(1)}å€ã«ãªã‚Šã¾ã™`
                });

                const oppositeMultiple = Math.pow(1 - rate, days);
                insights.push({
                    icon: 'âš ï¸',
                    text: `é€†ã«æ¯æ—¥${(rate * 100).toFixed(1)}%è¡°é€€ã™ã‚‹ã¨ã€${days}æ—¥å¾Œã«ã¯åˆæœŸå€¤ã®ç´„${(oppositeMultiple * 100).toFixed(1)}%ã¾ã§è½ã¡ã¾ã™`
                });

                const halfwayMultiple = Math.pow(1 + rate, Math.floor(days / 2));
                insights.push({
                    icon: 'ğŸ“Š',
                    text: `é€”ä¸­çµŒé: ${Math.floor(days / 2)}æ—¥ç›®ã§ç´„${halfwayMultiple.toFixed(1)}å€ï¼ˆæœ€çµ‚ã®${(halfwayMultiple / multiple * 100).toFixed(0)}%ï¼‰â€” ã“ã‚ŒãŒã€Œå¤±æœ›ã®è°·ã€ã§ã™`
                });
            } else if (rate < 0) {
                insights.push({
                    icon: 'ğŸ“‰',
                    text: `æ¯æ—¥${Math.abs(rate * 100).toFixed(1)}%è¡°é€€ã™ã‚‹ã¨ã€${days}æ—¥å¾Œã«ã¯åˆæœŸå€¤ã®ç´„${(multiple * 100).toFixed(1)}%ã«ãªã‚Šã¾ã™`
                });

                const recoveryMultiple = Math.pow(1 + Math.abs(rate), days);
                insights.push({
                    icon: 'ğŸ’ª',
                    text: `é€†ã«æ¯æ—¥${Math.abs(rate * 100).toFixed(1)}%æˆé•·ã™ã‚Œã°ã€${days}æ—¥ã§${recoveryMultiple.toFixed(1)}å€ã«ãªã‚Œã¾ã™`
                });
            }

            insights.push({
                icon: 'ğŸ”‘',
                text: 'ã€Œç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€â€” å°ã•ãªé¸æŠã®ç©ã¿é‡ã­ãŒã€ã‚ãªãŸã®æœªæ¥ã‚’å½¢ä½œã‚‹'
            });

            const insightList = document.getElementById('insightList');
            insightList.innerHTML = insights.map(i =>
                `<li><span>${i.icon}</span> <span>${i.text}</span></li>`
            ).join('');
        }

        drawValleyChart() {
            const canvas = document.getElementById('valleyChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.parentElement.clientWidth - 40;
            const height = 160;
            canvas.width = width;
            canvas.height = height;

            ctx.clearRect(0, 0, width, height);

            const padding = 30;
            const graphWidth = width - padding * 2;
            const graphHeight = height - padding * 2;

            // Draw axes
            ctx.strokeStyle = '#e0e6ed';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            // Expected (linear) growth
            ctx.strokeStyle = '#bdc3c7';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, padding);
            ctx.stroke();

            // Actual (exponential) growth
            ctx.strokeStyle = '#9b59b6';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath();
            const points = 50;
            for (let i = 0; i <= points; i++) {
                const x = padding + (graphWidth * i / points);
                const progress = i / points;
                const expValue = Math.pow(1.01, progress * 365) - 1;
                const normalizedValue = expValue / (Math.pow(1.01, 365) - 1);
                const y = height - padding - (normalizedValue * graphHeight);

                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Valley area annotation
            ctx.fillStyle = 'rgba(231, 76, 60, 0.1)';
            ctx.beginPath();
            ctx.moveTo(padding + graphWidth * 0.1, height - padding);
            ctx.lineTo(padding + graphWidth * 0.5, height - padding);
            ctx.lineTo(padding + graphWidth * 0.5, height - padding - graphHeight * 0.2);
            ctx.lineTo(padding + graphWidth * 0.1, height - padding - graphHeight * 0.05);
            ctx.closePath();
            ctx.fill();

            // Labels
            ctx.fillStyle = '#7f8c8d';
            ctx.font = '11px Noto Sans JP';
            ctx.textAlign = 'center';
            ctx.fillText('æ™‚é–“', width / 2, height - 5);
            ctx.save();
            ctx.translate(12, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('æˆé•·', 0, 0);
            ctx.restore();

            ctx.fillStyle = '#e74c3c';
            ctx.font = '10px Noto Sans JP';
            ctx.fillText('å¤±æœ›ã®è°·', padding + graphWidth * 0.3, height - padding - graphHeight * 0.05);
        }

        updateSkillChart(rate, days, initial) {
            const ctx = document.getElementById('skillChart').getContext('2d');

            if (this.state.skillChart) {
                this.state.skillChart.destroy();
            }

            const labels = [];
            const compoundData = [];
            const linearData = [];
            const dailyGrowthAmount = initial * rate;

            for (let i = 0; i <= days; i += Math.max(1, Math.floor(days / 50))) {
                labels.push(i + 'æ—¥');
                compoundData.push(initial * Math.pow(1 + rate, i));
                linearData.push(initial + dailyGrowthAmount * i);
            }

            if (typeof Chart !== 'undefined') {
                this.state.skillChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'è¤‡åˆ©æˆé•·',
                                data: compoundData,
                                borderColor: '#9b59b6',
                                backgroundColor: 'rgba(155, 89, 182, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 2
                            },
                            {
                                label: 'ç·šå½¢æˆé•·',
                                data: linearData,
                                borderColor: '#bdc3c7',
                                backgroundColor: 'rgba(189, 195, 199, 0.1)',
                                fill: true,
                                tension: 0,
                                pointRadius: 0,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => context.dataset.label + ': ' + this.formatNumber(context.raw)
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => this.formatNumber(value)
                                }
                            }
                        }
                    }
                });
            }
        }

        setupAssetListeners() {
            const assetRate = document.getElementById('assetRate');
            const assetYears = document.getElementById('assetYears');

            assetRate.addEventListener('input', () => {
                document.getElementById('assetRateValue').textContent = assetRate.value + '%';
                this.calculateAssetGrowth();
            });

            assetYears.addEventListener('input', () => {
                document.getElementById('assetYearsValue').textContent = assetYears.value + 'å¹´';
                this.calculateAssetGrowth();
            });

            ['principal', 'monthly', 'frequency'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => this.calculateAssetGrowth());
            });

            document.getElementById('calculateAssetBtn').addEventListener('click', () => {
                this.calculateAssetGrowth();
                this.showToast('è¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸ');
            });

            document.getElementById('copyAssetResultBtn').addEventListener('click', () => this.copyAssetResults());
            document.getElementById('resetAssetBtn').addEventListener('click', () => this.resetAsset());
            document.getElementById('exportCsvBtn').addEventListener('click', () => this.exportCSV());
        }

        calculateAssetGrowth() {
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const monthly = parseFloat(document.getElementById('monthly').value) || 0;
            const annualRate = parseFloat(document.getElementById('assetRate').value) / 100;
            const years = parseInt(document.getElementById('assetYears').value) || 0;
            const frequency = parseInt(document.getElementById('frequency').value);

            const yearlyData = [];
            let balance = principal;
            let totalInvested = principal;
            let totalInterest = 0;

            const periodicRate = annualRate / frequency;
            const monthlyToPeriodicRatio = 12 / frequency;

            for (let year = 1; year <= years; year++) {
                const startBalance = balance;
                let yearlyInvestment = 0;
                let yearlyInterest = 0;

                for (let period = 0; period < frequency; period++) {
                    const contribution = monthly * monthlyToPeriodicRatio;
                    balance += contribution;
                    yearlyInvestment += contribution;
                    totalInvested += contribution;

                    const interest = balance * periodicRate;
                    balance += interest;
                    yearlyInterest += interest;
                    totalInterest += interest;
                }

                yearlyData.push({
                    year,
                    startBalance: Math.round(startBalance),
                    investment: Math.round(yearlyInvestment),
                    interest: Math.round(yearlyInterest),
                    endBalance: Math.round(balance),
                    totalInvested: Math.round(totalInvested),
                    totalInterest: Math.round(totalInterest)
                });
            }

            const returnRate = totalInvested > 0 ? ((balance - totalInvested) / totalInvested * 100).toFixed(1) : 0;

            document.getElementById('finalAmount').textContent = this.formatCurrency(Math.round(balance));
            document.getElementById('totalInvested').textContent = this.formatCurrency(Math.round(totalInvested));
            document.getElementById('totalInterest').textContent = this.formatCurrency(Math.round(totalInterest));
            document.getElementById('returnRate').textContent = returnRate + '%';

            this.updateAssetChart(yearlyData, principal);
            this.updateAssetTable(yearlyData);

            this.state.yearlyData = yearlyData;
            this.state.assetResults = { finalAmount: balance, totalInvested, totalInterest, returnRate };
        }

        updateAssetChart(yearlyData, principal) {
            const ctx = document.getElementById('assetChart').getContext('2d');

            if (this.state.assetChart) {
                this.state.assetChart.destroy();
            }

            const labels = ['é–‹å§‹', ...yearlyData.map(d => d.year + 'å¹´ç›®')];
            const totalAssets = [principal, ...yearlyData.map(d => d.endBalance)];
            const investedAmounts = [principal, ...yearlyData.map(d => d.totalInvested)];
            const interests = [0, ...yearlyData.map(d => d.totalInterest)];

            if (typeof Chart !== 'undefined') {
                this.state.assetChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'ç·è³‡ç”£é¡',
                                data: totalAssets,
                                borderColor: '#3498db',
                                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'æŠ•è³‡å…ƒæœ¬',
                                data: investedAmounts,
                                borderColor: '#2ecc71',
                                backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'é‹ç”¨ç›Š',
                                data: interests,
                                borderColor: '#e74c3c',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => context.dataset.label + ': ' + this.formatCurrency(context.raw)
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => {
                                        if (value >= 100000000) return (value / 100000000).toFixed(1) + 'å„„';
                                        if (value >= 10000) return (value / 10000).toFixed(0) + 'ä¸‡';
                                        return value;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        updateAssetTable(yearlyData) {
            const tbody = document.getElementById('assetTableBody');
            tbody.innerHTML = yearlyData.map((data, index) => `
                <tr class="${index === yearlyData.length - 1 ? 'highlight-row' : ''}">
                    <td>${data.year}å¹´ç›®</td>
                    <td>${this.formatCurrency(data.startBalance)}</td>
                    <td>${this.formatCurrency(data.investment)}</td>
                    <td>${this.formatCurrency(data.interest)}</td>
                    <td>${this.formatCurrency(data.endBalance)}</td>
                    <td>${this.formatCurrency(data.totalInvested)}</td>
                    <td>${this.formatCurrency(data.totalInterest)}</td>
                </tr>
            `).join('');
        }

        formatNumber(value) {
            if (Math.abs(value) >= 1000000) {
                return (value / 1000000).toFixed(2) + 'M';
            } else if (Math.abs(value) >= 1000) {
                return (value / 1000).toFixed(1) + 'K';
            }
            return Math.round(value).toLocaleString();
        }

        formatCurrency(value) {
            if (value >= 100000000) {
                return (value / 100000000).toFixed(2) + 'å„„å††';
            } else if (value >= 10000) {
                return Math.round(value / 10000).toLocaleString() + 'ä¸‡å††';
            }
            return value.toLocaleString() + 'å††';
        }

        copySkillResults() {
            const rate = document.getElementById('skillRate').value;
            const days = document.getElementById('skillDays').value;
            const final = document.getElementById('finalSkill').textContent;
            const multiple = document.getElementById('growthMultiple').textContent;

            const text = `ã€è¤‡åˆ©æˆé•·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã€‘
æ—¥ã€…ã®æˆé•·ç‡: ${rate}%
ç¶™ç¶šæ—¥æ•°: ${days}æ—¥
æœ€çµ‚ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«: ${final}
æˆé•·å€ç‡: ${multiple}

ã€Œç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€â€” Atomic Habits
æ¯æ—¥ã®å°ã•ãªåŠªåŠ›ãŒã€å¤§ããªæˆé•·ã«ã¤ãªãŒã‚Šã¾ã™ã€‚`;

            this.copyToClipboard(text);
        }

        copyAssetResults() {
            const results = this.state.assetResults;
            if (!results) return;

            const text = `ã€è¤‡åˆ©è¨ˆç®—çµæœã€‘
æœ€çµ‚è³‡ç”£é¡: ${this.formatCurrency(results.finalAmount)}
ç·æŠ•è³‡é¡: ${this.formatCurrency(results.totalInvested)}
é‹ç”¨ç›Š: ${this.formatCurrency(results.totalInterest)}
åç›Šç‡: ${results.returnRate}%`;

            this.copyToClipboard(text);
        }

        copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => this.showToast('çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'))
                    .catch(() => this.fallbackCopy(text));
            } else {
                this.fallbackCopy(text);
            }
        }

        fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                this.showToast('çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            } catch (err) {
                this.showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
            document.body.removeChild(textarea);
        }

        exportCSV() {
            const data = this.state.yearlyData;
            if (!data || !data.length) return;

            let csv = 'å¹´,å¹´åˆæ®‹é«˜,ç©ç«‹é¡,åˆ©æ¯,å¹´æœ«æ®‹é«˜,ç´¯è¨ˆæŠ•è³‡é¡,ç´¯è¨ˆåˆ©æ¯\n';
            data.forEach(d => {
                csv += `${d.year},${d.startBalance},${d.investment},${d.interest},${d.endBalance},${d.totalInvested},${d.totalInterest}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `compound_interest_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            this.showToast('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }

        resetSkill() {
            document.getElementById('skillRate').value = 1.0;
            document.getElementById('skillDays').value = 365;
            document.getElementById('initialSkill').value = 100;
            document.getElementById('skillUnit').value = 'ãƒã‚¤ãƒ³ãƒˆ';
            document.getElementById('skillRateValue').textContent = '1.0%';
            document.getElementById('skillDaysValue').textContent = '365æ—¥';

            document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-preset="daily1"]').classList.add('active');

            this.calculateSkillGrowth();
            this.showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
        }

        resetAsset() {
            document.getElementById('principal').value = 1000000;
            document.getElementById('monthly').value = 30000;
            document.getElementById('assetRate').value = 5;
            document.getElementById('assetYears').value = 20;
            document.getElementById('frequency').value = 12;
            document.getElementById('assetRateValue').textContent = '5%';
            document.getElementById('assetYearsValue').textContent = '20å¹´';

            this.calculateAssetGrowth();
            this.showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
        }

        showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), duration);
        }
    }

    // Chart.js CDNèª­ã¿è¾¼ã¿
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    script.onload = () => new CompoundGrowthApp();
    script.onerror = () => new CompoundGrowthApp();
    document.head.appendChild(script);
  </script>
</body>

</html>
