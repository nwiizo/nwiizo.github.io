<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¤‡åˆ©ã®åŠ› - ç¿’æ…£ãŒäººç”Ÿã‚’å¤‰ãˆã‚‹</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap');

    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
        --purple-color: #9b59b6;
        --dark-color: #2c3e50;
        --light-bg: #f7f9fc;
        --card-bg: #ffffff;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --border-color: #e0e6ed;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    [data-theme="dark"] {
        --light-bg: #1a1a2e;
        --card-bg: #16213e;
        --text-primary: #eaeaea;
        --text-secondary: #a0a0a0;
        --border-color: #2a2a4a;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        --shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.4);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: var(--light-bg);
        color: var(--text-primary);
        line-height: 1.6;
        padding: 20px;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: var(--card-bg);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 40px;
        transition: all 0.3s ease;
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
        position: relative;
    }

    .theme-toggle {
        position: absolute;
        top: 0;
        right: 0;
        background: var(--light-bg);
        border: 2px solid var(--border-color);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .theme-toggle:hover {
        transform: rotate(20deg);
        border-color: var(--primary-color);
    }

    h1 {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .subtitle {
        color: var(--text-secondary);
        font-size: 16px;
        font-weight: 400;
    }

    .tab-container {
        display: flex;
        justify-content: center;
        gap: 0;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--border-color);
    }

    .tab-btn {
        padding: 15px 30px;
        font-size: 16px;
        border: none;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        position: relative;
    }

    .tab-btn:hover {
        color: var(--primary-color);
    }

    .tab-btn.active {
        color: var(--primary-color);
    }

    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-color);
        border-radius: 3px 3px 0 0;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Quote Banner with rotation */
    .quote-banner {
        background: linear-gradient(135deg, var(--purple-color), var(--primary-color));
        color: white;
        padding: 35px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .quote-banner:hover {
        transform: scale(1.01);
    }

    .quote-banner::before {
        content: '"';
        position: absolute;
        top: -20px;
        left: 20px;
        font-size: 120px;
        opacity: 0.1;
        font-family: Georgia, serif;
    }

    .quote-banner h2 {
        font-size: 22px;
        margin-bottom: 15px;
        line-height: 1.4;
        transition: opacity 0.3s ease;
    }

    .quote-banner .quote-source {
        font-size: 14px;
        opacity: 0.9;
        font-style: italic;
    }

    .quote-hint {
        font-size: 12px;
        opacity: 0.7;
        margin-top: 10px;
    }

    /* Time machine section */
    .timemachine-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        border: 2px dashed var(--border-color);
    }

    .timemachine-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .timemachine-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .timemachine-card {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .timemachine-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .timemachine-label {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .timemachine-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--purple-color);
    }

    /* Real world examples */
    .examples-section {
        background: var(--light-bg);
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .examples-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .examples-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }

    .example-card {
        background: var(--card-bg);
        padding: 18px;
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    .example-card:hover {
        transform: translateX(5px);
    }

    .example-domain {
        font-size: 12px;
        color: var(--primary-color);
        text-transform: uppercase;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .example-text {
        font-size: 14px;
        color: var(--text-primary);
        line-height: 1.6;
    }

    /* Comparison Mode */
    .comparison-mode {
        background: var(--light-bg);
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .comparison-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .comparison-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .comparison-toggle {
        padding: 8px 16px;
        border: 2px solid var(--border-color);
        background: var(--card-bg);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .comparison-toggle:hover {
        border-color: var(--primary-color);
    }

    .comparison-toggle.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .comparison-content {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .comparison-content.active {
        display: grid;
    }

    .comparison-panel {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        border-top: 4px solid var(--primary-color);
    }

    .comparison-panel.panel-b {
        border-top-color: var(--secondary-color);
    }

    .comparison-panel-title {
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .comparison-result {
        margin-top: 15px;
        padding: 15px;
        background: var(--light-bg);
        border-radius: 8px;
        text-align: center;
    }

    .comparison-result-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
    }

    .comparison-panel.panel-b .comparison-result-value {
        color: var(--secondary-color);
    }

    .comparison-diff {
        margin-top: 20px;
        padding: 20px;
        background: var(--card-bg);
        border-radius: 10px;
        text-align: center;
        grid-column: span 2;
    }

    .comparison-diff-label {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .comparison-diff-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--warning-color);
    }

    /* Core Concept Section */
    .concept-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .concept-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .concept-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .concept-card {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
        transition: all 0.3s ease;
    }

    .concept-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .concept-card.positive {
        border-left-color: var(--secondary-color);
    }

    .concept-card.negative {
        border-left-color: var(--danger-color);
    }

    .concept-card.neutral {
        border-left-color: var(--warning-color);
    }

    .concept-card-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }

    .concept-card-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .concept-card-desc {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.6;
    }

    .concept-card-formula {
        margin-top: 12px;
        padding: 10px;
        background: var(--light-bg);
        border-radius: 6px;
        font-family: 'Monaco', monospace;
        font-size: 13px;
        color: var(--primary-color);
        text-align: center;
    }

    /* Valley of Disappointment */
    .valley-section {
        background: linear-gradient(135deg, rgba(231, 76, 60, 0.05), rgba(155, 89, 182, 0.05));
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        border: 2px solid var(--border-color);
    }

    .valley-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .valley-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: center;
    }

    .valley-text {
        font-size: 15px;
        color: var(--text-secondary);
        line-height: 1.8;
    }

    .valley-text strong {
        color: var(--text-primary);
    }

    .valley-text .highlight {
        background: linear-gradient(transparent 60%, rgba(155, 89, 182, 0.2) 60%);
        padding: 0 2px;
    }

    .valley-chart {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        height: 200px;
    }

    /* Input Sections */
    .input-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .input-group {
        background: var(--light-bg);
        padding: 20px;
        border-radius: 12px;
    }

    .input-group-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .slider-field {
        margin-bottom: 20px;
    }

    .slider-field:last-child {
        margin-bottom: 0;
    }

    .slider-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .slider-header label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .slider-value {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 18px;
    }

    .slider-input {
        width: 100%;
        -webkit-appearance: none;
        height: 8px;
        border-radius: 4px;
        background: var(--border-color);
        outline: none;
        transition: all 0.3s ease;
    }

    .slider-input::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(52, 152, 219, 0.4);
    }

    .slider-input::-webkit-slider-thumb:hover {
        transform: scale(1.2);
    }

    .input-field {
        margin-bottom: 15px;
    }

    .input-field label {
        display: block;
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 6px;
        font-weight: 500;
    }

    .input-field input,
    .input-field select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        font-family: inherit;
        transition: all 0.3s ease;
        background: var(--card-bg);
        color: var(--text-primary);
    }

    .input-field input:focus,
    .input-field select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .input-with-unit {
        position: relative;
    }

    .input-with-unit input {
        padding-right: 50px;
    }

    .input-unit {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
    }

    /* Habit Scenarios */
    .scenarios-section {
        margin-bottom: 30px;
    }

    .scenarios-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .scenarios-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
    }

    .scenario-btn {
        padding: 18px;
        border: 2px solid var(--border-color);
        background: var(--card-bg);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: left;
        position: relative;
        overflow: hidden;
    }

    .scenario-btn:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }

    .scenario-btn.active {
        border-color: var(--primary-color);
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(155, 89, 182, 0.05));
    }

    .scenario-btn.active::after {
        content: 'âœ“';
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .scenario-icon {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .scenario-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
        font-size: 14px;
    }

    .scenario-desc {
        font-size: 11px;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .scenario-result {
        font-size: 12px;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 5px;
        display: inline-block;
    }

    .scenario-result.positive {
        background: rgba(46, 204, 113, 0.1);
        color: var(--secondary-color);
    }

    .scenario-result.negative {
        background: rgba(231, 76, 60, 0.1);
        color: var(--danger-color);
    }

    /* Results Grid */
    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .result-card {
        background: var(--light-bg);
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .result-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.1);
    }

    .result-card.highlight {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(52, 152, 219, 0.1));
        border-color: var(--purple-color);
    }

    .result-card.growth {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
        border-color: var(--secondary-color);
    }

    .result-icon {
        font-size: 32px;
        margin-bottom: 10px;
    }

    .result-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 5px;
        transition: all 0.3s ease;
    }

    .result-value.animating {
        transform: scale(1.1);
    }

    .result-card.highlight .result-value {
        color: var(--purple-color);
    }

    .result-card.growth .result-value {
        color: var(--secondary-color);
    }

    .result-label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .result-sub {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 5px;
    }

    /* Chart Section */
    .chart-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chart-container {
        position: relative;
        height: 350px;
        background: var(--card-bg);
        border-radius: 8px;
        padding: 20px;
    }

    .chart-legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-secondary);
    }

    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
    }

    /* 4 Laws Section */
    .laws-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(46, 204, 113, 0.05));
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .laws-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        text-align: center;
    }

    .laws-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
    }

    .law-card {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .law-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }

    .law-card.expanded {
        grid-column: span 2;
    }

    .law-number {
        width: 36px;
        height: 36px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        margin: 0 auto 12px;
    }

    .law-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 8px;
    }

    .law-desc {
        font-size: 13px;
        color: var(--text-secondary);
    }

    .law-detail {
        display: none;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        text-align: left;
        font-size: 13px;
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .law-card.expanded .law-detail {
        display: block;
    }

    /* Insight Section */
    .insight-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05), rgba(155, 89, 182, 0.05));
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        border-left: 4px solid var(--purple-color);
    }

    .insight-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .insight-list {
        list-style: none;
    }

    .insight-list li {
        padding: 12px 0;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .insight-list li:last-child {
        border-bottom: none;
    }

    .insight-list li span:first-child {
        font-size: 20px;
        flex-shrink: 0;
    }

    /* Share Section */
    .share-section {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .share-btn {
        padding: 12px 20px;
        border: 2px solid var(--border-color);
        background: var(--card-bg);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        color: var(--text-primary);
    }

    .share-btn:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        background-color: #2980b9;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background-color: var(--secondary-color);
        color: white;
    }

    .btn-secondary:hover {
        background-color: #27ae60;
        transform: translateY(-2px);
    }

    .btn-outline {
        background-color: transparent;
        color: var(--text-primary);
        border: 2px solid var(--border-color);
    }

    .btn-outline:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-2px);
    }

    /* Asset Tab Styles */
    .calculate-btn {
        width: 100%;
        padding: 15px 30px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: inherit;
        font-weight: 600;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
    }

    .table-section {
        background: var(--light-bg);
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
    }

    .table-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .table-wrapper {
        overflow-x: auto;
        background: var(--card-bg);
        border-radius: 8px;
        max-height: 400px;
        overflow-y: auto;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .data-table th,
    .data-table td {
        padding: 12px 15px;
        text-align: right;
        border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
        background: var(--light-bg);
        font-weight: 600;
        color: var(--text-primary);
        position: sticky;
        top: 0;
        z-index: 1;
    }

    .data-table th:first-child,
    .data-table td:first-child {
        text-align: center;
    }

    .data-table tr:hover {
        background: rgba(52, 152, 219, 0.05);
    }

    .data-table .highlight-row {
        background: rgba(46, 204, 113, 0.1);
    }

    .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        padding: 16px 24px;
        background: var(--dark-color);
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 1001;
        font-size: 14px;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }

        h1 {
            font-size: 24px;
        }

        .tab-btn {
            padding: 12px 15px;
            font-size: 14px;
        }

        .input-section {
            grid-template-columns: 1fr;
        }

        .results-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .chart-container {
            height: 250px;
        }

        .valley-content {
            grid-template-columns: 1fr;
        }

        .scenarios-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .comparison-content {
            grid-template-columns: 1fr;
        }

        .comparison-diff {
            grid-column: span 1;
        }

        .law-card.expanded {
            grid-column: span 1;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--light-bg);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <button class="theme-toggle" id="themeToggle" title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿">ğŸŒ™</button>
      <h1>
        <span>ğŸ“ˆ</span>
        è¤‡åˆ©ã®åŠ›
      </h1>
      <p class="subtitle">ç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ - Atomic Habits</p>
    </div>

    <div class="tab-container">
      <button class="tab-btn active" data-tab="skill">
        <span>ğŸš€</span> ç¿’æ…£ã®åŠ›
      </button>
      <button class="tab-btn" data-tab="asset">
        <span>ğŸ’°</span> è³‡ç”£é‹ç”¨
      </button>
    </div>

    <!-- ç¿’æ…£ã®åŠ›ã‚¿ãƒ– -->
    <div class="tab-content active" id="skillTab">
      <div class="quote-banner" id="quoteBanner">
        <h2 id="quoteText">æ¯æ—¥1%è‰¯ããªã‚Œã°ã€1å¹´å¾Œã«ã¯37å€è‰¯ããªã‚‹ã€‚<br>æ¯æ—¥1%æ‚ªããªã‚Œã°ã€1å¹´å¾Œã«ã¯ã»ã¼ã‚¼ãƒ­ã«ãªã‚‹ã€‚</h2>
        <p class="quote-source" id="quoteSource">â€” James Clearã€Atomic Habitsã€ã‚ˆã‚Š</p>
      </div>

      <!-- Time Machine -->
      <div class="timemachine-section" id="timemachineSection" style="cursor: pointer;">
        <div class="timemachine-title">
          <span>â°</span> ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³ - ã‚‚ã—æ—©ãå§‹ã‚ã¦ã„ãŸã‚‰...
        </div>
        <div class="timemachine-content" id="timemachineContent">
          <div class="timemachine-card">
            <div class="timemachine-label">30æ—¥å‰ã«å§‹ã‚ã¦ã„ãŸã‚‰</div>
            <div class="timemachine-value" id="tm30">-</div>
          </div>
          <div class="timemachine-card">
            <div class="timemachine-label">90æ—¥å‰ã«å§‹ã‚ã¦ã„ãŸã‚‰</div>
            <div class="timemachine-value" id="tm90">-</div>
          </div>
          <div class="timemachine-card">
            <div class="timemachine-label">1å¹´å‰ã«å§‹ã‚ã¦ã„ãŸã‚‰</div>
            <div class="timemachine-value" id="tm365">-</div>
          </div>
          <div class="timemachine-card">
            <div class="timemachine-label">ä»Šæ—¥å§‹ã‚ã‚Œã°1å¹´å¾Œ</div>
            <div class="timemachine-value" id="tmFuture">-</div>
          </div>
        </div>
      </div>

      <!-- Core Concepts -->
      <div class="concept-section">
        <div class="concept-title">
          <span>ğŸ’¡</span> è¤‡åˆ©åŠ¹æœã®æœ¬è³ª
        </div>
        <div class="concept-grid">
          <div class="concept-card positive" style="cursor: pointer;">
            <div class="concept-card-icon">ğŸ“ˆ</div>
            <div class="concept-card-title">1%ã®æ”¹å–„ã‚’æ¯æ—¥ç¶šã‘ã‚‹</div>
            <div class="concept-card-desc">å°ã•ãªæ”¹å–„ã¯ç›®ç«‹ãŸãªã„ãŒã€æ™‚é–“ã¨ã¨ã‚‚ã«æŒ‡æ•°é–¢æ•°çš„ã«æˆé•·ã™ã‚‹ã€‚</div>
            <div class="concept-card-formula">1.01^365 = 37.78</div>
            <div class="concept-card-detail" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
              æœ€åˆã®æ•°ãƒ¶æœˆã¯å¤‰åŒ–ã‚’æ„Ÿã˜ã«ãã„ã€‚ã“ã‚ŒãŒå¤šãã®äººãŒè«¦ã‚ã‚‹ç†ç”±ã€‚ã—ã‹ã—è¤‡åˆ©æ›²ç·šã¯å¾ŒåŠã§æ€¥æ¿€ã«ä¸Šæ˜‡ã™ã‚‹ã€‚<br><br>
              ä¾‹ãˆã°100æ—¥ç›®ã§ç´„2.7å€ã€200æ—¥ç›®ã§ç´„7.3å€ã€ãã—ã¦365æ—¥ç›®ã§ç´„37.8å€ã€‚æˆé•·ã®80%ã¯æœ€å¾Œã®20%ã®æœŸé–“ã§èµ·ã“ã‚‹ã€‚<br><br>
              é‡è¦ãªã®ã¯ã€Œä»Šæ—¥ã ã‘1%è‰¯ããªã‚‹ã€ã“ã¨ã€‚æ˜æ—¥ã®ã“ã¨ã¯æ˜æ—¥è€ƒãˆã‚Œã°ã„ã„ã€‚
            </div>
          </div>
          <div class="concept-card negative" style="cursor: pointer;">
            <div class="concept-card-icon">ğŸ“‰</div>
            <div class="concept-card-title">1%ã®æ‚ªåŒ–ã‚’æ¯æ—¥ç¶šã‘ã‚‹</div>
            <div class="concept-card-desc">å°ã•ãªæ‚ªç¿’æ…£ã‚‚è¤‡åˆ©ã§è“„ç©ã™ã‚‹ã€‚æ¯æ—¥å°‘ã—ãšã¤è¡°é€€ã™ã‚Œã°ã€ã»ã¨ã‚“ã©ä½•ã‚‚æ®‹ã‚‰ãªã„ã€‚</div>
            <div class="concept-card-formula">0.99^365 = 0.03</div>
            <div class="concept-card-detail" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
              ã€Œä»Šæ—¥ãã‚‰ã„ã‚µãƒœã£ã¦ã‚‚å¤§ä¸ˆå¤«ã€ã¨ã„ã†è€ƒãˆãŒå±é™ºãªã®ã¯ã€1æ—¥ã®å½±éŸ¿ãŒè¦‹ãˆãªã„ã‹ã‚‰ã€‚<br><br>
              ã—ã‹ã—1%ã®è¡°é€€ã‚’365æ—¥ç¶šã‘ã‚‹ã¨ã€å…ƒã®3%ã—ã‹æ®‹ã‚‰ãªã„ã€‚ã‚¹ã‚­ãƒ«ã€å¥åº·ã€äººé–“é–¢ä¿‚ã€ã™ã¹ã¦ã«å½“ã¦ã¯ã¾ã‚‹ã€‚<br><br>
              æ‚ªç¿’æ…£ã®æ€–ã•ã¯ã€æ°—ã¥ã„ãŸæ™‚ã«ã¯å–ã‚Šè¿”ã™ã®ã«ä½•å€ã‚‚ã®åŠªåŠ›ãŒå¿…è¦ã«ãªã‚‹ã“ã¨ã€‚äºˆé˜²ã¯æ²»ç™‚ã«å‹ã‚‹ã€‚
            </div>
          </div>
          <div class="concept-card neutral" style="cursor: pointer;">
            <div class="concept-card-icon">â³</div>
            <div class="concept-card-title">72ã®æ³•å‰‡</div>
            <div class="concept-card-desc">2å€ã«ãªã‚‹ã¾ã§ã®æœŸé–“ã¯ã€72ã‚’æˆé•·ç‡ã§å‰²ã‚Œã°åˆ†ã‹ã‚‹ã€‚</div>
            <div class="concept-card-formula">å€ã«ãªã‚‹æ—¥æ•° = 72 Ã· æˆé•·ç‡(%)</div>
            <div class="concept-card-detail" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); font-size: 13px; line-height: 1.8; color: var(--text-secondary);">
              1%æˆé•·ãªã‚‰72æ—¥ã§2å€ã€2%ãªã‚‰36æ—¥ã§2å€ã€0.5%ãªã‚‰144æ—¥ã§2å€ã€‚<br><br>
              ã“ã®æ³•å‰‡ã¯æŠ•è³‡ã ã‘ã§ãªãã€ã‚¹ã‚­ãƒ«ç¿’å¾—ã«ã‚‚ä½¿ãˆã‚‹ã€‚æ¯æ—¥1%æˆé•·ã§ãã‚Œã°ã€ç´„72æ—¥ã§èƒ½åŠ›ãŒ2å€ã«ãªã‚‹è¨ˆç®—ã€‚<br><br>
              é€†ã«è¨€ãˆã°ã€æˆé•·ç‡ã‚’å°‘ã—ä¸Šã’ã‚‹ã ã‘ã§ã€ç›®æ¨™é”æˆã¾ã§ã®æ™‚é–“ãŒåŠ‡çš„ã«çŸ­ç¸®ã•ã‚Œã‚‹ã€‚0.5%â†’1%ã«ã™ã‚‹ã ã‘ã§ã€2å€ã«ãªã‚‹æœŸé–“ãŒåŠåˆ†ã«ãªã‚‹ã€‚
            </div>
          </div>
        </div>
      </div>

      <!-- Real World Examples -->
      <div class="examples-section">
        <div class="examples-title">
          <span>ğŸŒ</span> 1%æ”¹å–„ã®å…·ä½“ä¾‹
        </div>
        <div class="examples-grid">
          <div class="example-card" style="cursor: pointer;">
            <div class="example-domain">ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</div>
            <div class="example-text">æ¯æ—¥15åˆ†ã ã‘æ–°ã—ã„æ¦‚å¿µã‚’å­¦ã¶ã€‚1ã¤ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¦šãˆã‚‹ã€‚</div>
            <div class="example-card-detail" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); font-size: 12px; line-height: 1.7; color: var(--text-secondary);">
              å…·ä½“çš„ã«ã¯ï¼šæ–°ã—ã„APIã‚’1ã¤è©¦ã™ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’1ã¤æ·±ãèª¿ã¹ã‚‹ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’1ç®‡æ‰€ã ã‘è¡Œã†ã€‚<br><br>
              1å¹´å¾Œã«ã¯5,475åˆ†ï¼ˆç´„91æ™‚é–“ï¼‰ã®å­¦ç¿’æ™‚é–“ã€‚ã“ã‚Œã¯å…¥é–€æ›¸ã‚’æ•°å†Šãƒã‚¹ã‚¿ãƒ¼ã§ãã‚‹æ™‚é–“ã€‚å°ã•ãªç©ã¿é‡ã­ãŒå°‚é–€æ€§ã‚’ä½œã‚‹ã€‚
            </div>
          </div>
          <div class="example-card" style="cursor: pointer;">
            <div class="example-domain">èª­æ›¸</div>
            <div class="example-text">æ¯æ—¥10ãƒšãƒ¼ã‚¸èª­ã‚€ã€‚1å¹´ã§3,650ãƒšãƒ¼ã‚¸ = ç´„15å†Šã®æœ¬ã€‚</div>
            <div class="example-card-detail" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); font-size: 12px; line-height: 1.7; color: var(--text-secondary);">
              10ãƒšãƒ¼ã‚¸ã¯ç´„15-20åˆ†ã€‚é€šå‹¤æ™‚é–“ã‚„å¯ã‚‹å‰ã®æ™‚é–“ã§ååˆ†å¯èƒ½ã€‚<br><br>
              5å¹´ç¶šã‘ã‚Œã°75å†Šã€‚10å¹´ã§150å†Šã€‚èª­æ›¸é‡ã¨å¹´åã«ã¯ç›¸é–¢ãŒã‚ã‚‹ã¨ã„ã†ç ”ç©¶ã‚‚ã‚ã‚‹ã€‚çŸ¥è­˜ã®è¤‡åˆ©åŠ¹æœã¯è¨ˆã‚ŠçŸ¥ã‚Œãªã„ã€‚
            </div>
          </div>
          <div class="example-card" style="cursor: pointer;">
            <div class="example-domain">é‹å‹•</div>
            <div class="example-text">è…•ç«‹ã¦ä¼ã›ã‚’æ˜¨æ—¥ã‚ˆã‚Š1å›å¤šãã‚„ã‚‹ã€‚æœ€åˆã¯1å›ã§ã‚‚OKã€‚</div>
            <div class="example-card-detail" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); font-size: 12px; line-height: 1.7; color: var(--text-secondary);">
              1æ—¥ç›®ï¼š1å›ã€30æ—¥ç›®ï¼š30å›ã€100æ—¥ç›®ï¼š100å›ã€‚ã“ã‚ŒãŒè¤‡åˆ©çš„æˆé•·ã€‚<br><br>
              é‡è¦ãªã®ã¯ã€Œã§ãã‚‹ç¯„å›²ã§å§‹ã‚ã‚‹ã€ã“ã¨ã€‚å®Œç’§ã‚’æ±‚ã‚ãšã€ç¶™ç¶šã‚’å„ªå…ˆã™ã‚‹ã€‚ä½“åŠ›ãŒã¤ã‘ã°è‡ªç„¶ã¨é‡ã‚‚å¢—ãˆã‚‹ã€‚ç¿’æ…£ãŒå…ˆã€çµæœã¯å¾Œã‹ã‚‰ã¤ã„ã¦ãã‚‹ã€‚
            </div>
          </div>
          <div class="example-card" style="cursor: pointer;">
            <div class="example-domain">èªå­¦</div>
            <div class="example-text">æ¯æ—¥5ã¤ã®æ–°ã—ã„å˜èªã‚’è¦šãˆã‚‹ã€‚1å¹´ã§1,825èªã€‚</div>
            <div class="example-card-detail" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); font-size: 12px; line-height: 1.7; color: var(--text-secondary);">
              æ—¥å¸¸ä¼šè©±ã«å¿…è¦ãªèªå½™ã¯ç´„2,000-3,000èªã€‚1å¹´ã§ã»ã¼ã‚«ãƒãƒ¼ã§ãã‚‹è¨ˆç®—ã€‚<br><br>
              ã•ã‚‰ã«ã€å˜èªã¯é–¢é€£èªã‚’å‘¼ã³ã€ç†è§£ãŒç†è§£ã‚’ç”Ÿã‚€ã€‚æœ€åˆã¯1å˜èªè¦šãˆã‚‹ã®ã«5åˆ†ã‹ã‹ã£ã¦ã‚‚ã€æ…£ã‚Œã‚Œã°1åˆ†ã§è¦šãˆã‚‰ã‚Œã‚‹ã€‚å­¦ç¿’åŠ¹ç‡è‡ªä½“ã‚‚è¤‡åˆ©ã§å‘ä¸Šã™ã‚‹ã€‚
            </div>
          </div>
        </div>
      </div>

      <!-- Valley of Disappointment -->
      <div class="valley-section">
        <div class="valley-title">
          <span>ğŸ”ï¸</span> å¤±æœ›ã®è°·ï¼ˆValley of Disappointmentï¼‰
        </div>
        <div class="valley-content">
          <div class="valley-text">
            <p><strong>åŠªåŠ›ã®æˆæœã¯ç›´ç·šçš„ã«ç¾ã‚Œãªã„ã€‚</strong></p>
            <p style="margin-top: 12px;">æˆé•·æ›²ç·šã¯æœ€åˆã¯ç·©ã‚„ã‹ã§ã€ã‚ã‚‹æ™‚ç‚¹ã‹ã‚‰æ€¥æ¿€ã«ä¸Šæ˜‡ã™ã‚‹ã€‚å¤šãã®äººã¯ã“ã®<span class="highlight">ã€Œå¤±æœ›ã®è°·ã€</span>ã§è«¦ã‚ã¦ã—ã¾ã†ã€‚</p>
            <p style="margin-top: 12px; padding: 12px; background: var(--card-bg); border-radius: 8px; font-weight: 500;">
              ğŸ¯ ãƒ–ãƒ¬ã‚¤ã‚¯ã‚¹ãƒ«ãƒ¼ã¯ã€çªç„¶ã§ã¯ãªã<strong>è“„ç©ã•ã‚ŒãŸåŠªåŠ›ã®çµæœ</strong>ã¨ã—ã¦è¨ªã‚Œã‚‹
            </p>
          </div>
          <div class="valley-chart">
            <canvas id="valleyChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Comparison Mode -->
      <div class="comparison-mode">
        <div class="comparison-header">
          <div class="comparison-title">
            <span>âš”ï¸</span> ã‚·ãƒŠãƒªã‚ªæ¯”è¼ƒ
          </div>
          <button class="comparison-toggle" id="comparisonToggle">æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã‚’ON</button>
        </div>
        <div class="comparison-content" id="comparisonContent">
          <div class="comparison-panel panel-a">
            <div class="comparison-panel-title"><span>ğŸ”µ</span> ã‚·ãƒŠãƒªã‚ªA</div>
            <div class="slider-field">
              <div class="slider-header">
                <label>æˆé•·ç‡</label>
                <span class="slider-value" id="compRateAValue">1%</span>
              </div>
              <input type="range" class="slider-input" id="compRateA" value="1" min="0.1" max="5" step="0.1">
            </div>
            <div class="comparison-result">
              <div class="comparison-result-value" id="compResultA">37.8x</div>
              <div>1å¹´å¾Œã®æˆé•·å€ç‡</div>
            </div>
          </div>
          <div class="comparison-panel panel-b">
            <div class="comparison-panel-title"><span>ğŸŸ¢</span> ã‚·ãƒŠãƒªã‚ªB</div>
            <div class="slider-field">
              <div class="slider-header">
                <label>æˆé•·ç‡</label>
                <span class="slider-value" id="compRateBValue">0.5%</span>
              </div>
              <input type="range" class="slider-input" id="compRateB" value="0.5" min="0.1" max="5" step="0.1">
            </div>
            <div class="comparison-result">
              <div class="comparison-result-value" id="compResultB">6.2x</div>
              <div>1å¹´å¾Œã®æˆé•·å€ç‡</div>
            </div>
          </div>
          <div class="comparison-diff">
            <div class="comparison-diff-label">1æ—¥ãŸã£ãŸ0.5%ã®å·®ãŒ1å¹´å¾Œã«ã¯...</div>
            <div class="comparison-diff-value" id="compDiff">6.1å€ã®å·®</div>
          </div>
          <div class="comparison-chart-container" style="grid-column: span 2; height: 250px; margin-top: 20px;">
            <canvas id="comparisonChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Scenarios -->
      <div class="scenarios-section">
        <div class="scenarios-title">
          <span>ğŸ­</span> ã‚·ãƒŠãƒªã‚ªã‚’é¸ã‚“ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        </div>
        <div class="scenarios-grid">
          <button class="scenario-btn active" data-preset="daily1">
            <div class="scenario-icon">ğŸ“š</div>
            <div class="scenario-name">æ¯æ—¥1%æˆé•·</div>
            <div class="scenario-desc">æ¯æ—¥å°‘ã—ãšã¤å­¦ç¿’</div>
            <div class="scenario-result positive">37.8å€</div>
          </button>
          <button class="scenario-btn" data-preset="daily05">
            <div class="scenario-icon">ğŸ¯</div>
            <div class="scenario-name">æ¯æ—¥0.5%æˆé•·</div>
            <div class="scenario-desc">å¿™ã—ãã¦ã‚‚ç¶™ç¶š</div>
            <div class="scenario-result positive">6.2å€</div>
          </button>
          <button class="scenario-btn" data-preset="daily01">
            <div class="scenario-icon">ğŸ¢</div>
            <div class="scenario-name">æ¯æ—¥0.1%æˆé•·</div>
            <div class="scenario-desc">è¶…å°ã•ãªä¸€æ­©</div>
            <div class="scenario-result positive">1.44å€</div>
          </button>
          <button class="scenario-btn" data-preset="decline">
            <div class="scenario-icon">ğŸ“‰</div>
            <div class="scenario-name">æ¯æ—¥1%è¡°é€€</div>
            <div class="scenario-desc">ä½•ã‚‚ã—ãªã„</div>
            <div class="scenario-result negative">3%ã«</div>
          </button>
          <button class="scenario-btn" data-preset="weekly">
            <div class="scenario-icon">ğŸ“…</div>
            <div class="scenario-name">é€±1ã§5%æˆé•·</div>
            <div class="scenario-desc">é€±æœ«é›†ä¸­å‹</div>
            <div class="scenario-result positive">12.6å€</div>
          </button>
          <button class="scenario-btn" data-preset="sprint">
            <div class="scenario-icon">ğŸƒ</div>
            <div class="scenario-name">30æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
            <div class="scenario-desc">2%Ã—30æ—¥</div>
            <div class="scenario-result positive">1.81å€</div>
          </button>
        </div>
      </div>

      <!-- Input Section -->
      <div class="input-section">
        <div class="input-group">
          <div class="input-group-title">
            <span>âš¡</span> æˆé•·ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>æ—¥ã€…ã®æˆé•·ç‡</label>
              <span class="slider-value" id="skillRateValue">1.0%</span>
            </div>
            <input type="range" class="slider-input" id="skillRate" value="1.0" min="-2" max="5" step="0.1">
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>ç¶™ç¶šæ—¥æ•°</label>
              <span class="slider-value" id="skillDaysValue">365æ—¥</span>
            </div>
            <input type="range" class="slider-input" id="skillDays" value="365" min="1" max="1095" step="1">
          </div>
        </div>

        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ®</span> åˆæœŸè¨­å®š
          </div>
          <div class="input-field">
            <label for="initialSkill">åˆæœŸã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«</label>
            <input type="number" id="initialSkill" value="100" min="1" step="1">
          </div>
          <div class="input-field">
            <label for="skillUnit">å˜ä½ï¼ˆä»»æ„ï¼‰</label>
            <input type="text" id="skillUnit" value="ãƒã‚¤ãƒ³ãƒˆ" placeholder="ä¾‹: ãƒã‚¤ãƒ³ãƒˆã€ãƒ¬ãƒ™ãƒ«">
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="results-grid" id="skillResults">
        <div class="result-card highlight">
          <div class="result-icon">ğŸ†</div>
          <div class="result-value" id="finalSkill">3,778</div>
          <div class="result-label">æœ€çµ‚ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«</div>
        </div>
        <div class="result-card growth">
          <div class="result-icon">ğŸ“ˆ</div>
          <div class="result-value" id="growthMultiple">37.8x</div>
          <div class="result-label">æˆé•·å€ç‡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ“Š</div>
          <div class="result-value" id="totalGrowth">+3,678</div>
          <div class="result-label">ç·æˆé•·é‡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">â°</div>
          <div class="result-value" id="doublingTime">70æ—¥</div>
          <div class="result-label">2å€ã«ãªã‚‹ã¾ã§</div>
          <div class="result-sub">72ã®æ³•å‰‡</div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-section">
        <div class="chart-title">
          <span>ğŸ“‰</span> æˆé•·æ›²ç·š - è¤‡åˆ© vs ç·šå½¢
        </div>
        <div class="chart-container">
          <canvas id="skillChart"></canvas>
        </div>
        <div class="chart-legend" id="skillLegend">
          <div class="legend-item">
            <div class="legend-color" style="background: #9b59b6;"></div>
            <span>è¤‡åˆ©æˆé•·ï¼ˆå®Ÿéš›ï¼‰</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #bdc3c7;"></div>
            <span>ç·šå½¢æˆé•·ï¼ˆæœŸå¾…ï¼‰</span>
          </div>
        </div>
      </div>

      <!-- 4 Laws of Behavior Change -->
      <div class="laws-section">
        <div class="laws-title">ğŸ”„ è¡Œå‹•å¤‰å®¹ã®4ã¤ã®æ³•å‰‡</div>
        <div class="laws-grid">
          <div class="law-card" data-law="1">
            <div class="law-number">1</div>
            <div class="law-title">æ˜ç¢ºã«ã™ã‚‹</div>
            <div class="law-desc">Make it Obvious</div>
            <div class="law-detail">
              <strong>å®Ÿè·µæ–¹æ³•:</strong><br>
              â€¢ å®Ÿè¡Œæ„å›³: ã€Œã„ã¤ã€ã€Œã©ã“ã§ã€ã€Œä½•ã‚’ã€ã™ã‚‹ã‹æ˜ç¢ºã«<br>
              â€¢ ç¿’æ…£ã®ç©ã¿é‡ã­: æ—¢å­˜ã®ç¿’æ…£ã®å¾Œã«æ–°ç¿’æ…£ã‚’è¿½åŠ <br>
              â€¢ ç’°å¢ƒãƒ‡ã‚¶ã‚¤ãƒ³: ãã£ã‹ã‘ã‚’ç›®ã«è¦‹ãˆã‚‹å ´æ‰€ã«ç½®ã
            </div>
          </div>
          <div class="law-card" data-law="2">
            <div class="law-number">2</div>
            <div class="law-title">é­…åŠ›çš„ã«ã™ã‚‹</div>
            <div class="law-desc">Make it Attractive</div>
            <div class="law-detail">
              <strong>å®Ÿè·µæ–¹æ³•:</strong><br>
              â€¢ èª˜æƒ‘ã®æŠ±ãåˆã‚ã›: ã‚„ã‚ŠãŸã„ã“ã¨ã¨çµ„ã¿åˆã‚ã›ã‚‹<br>
              â€¢ ä»²é–“ã¨ä¸€ç·’ã«: ç¿’æ…£ãŒå½“ãŸã‚Šå‰ã®é›†å›£ã«å±ã™ã‚‹<br>
              â€¢ å‹•æ©Ÿã‚’å†æ§‹ç¯‰: ã‚„ã‚‰ãªã‘ã‚Œã°â†’ã‚„ã‚ŠãŸã„ã«å¤‰ãˆã‚‹
            </div>
          </div>
          <div class="law-card" data-law="3">
            <div class="law-number">3</div>
            <div class="law-title">ç°¡å˜ã«ã™ã‚‹</div>
            <div class="law-desc">Make it Easy</div>
            <div class="law-detail">
              <strong>å®Ÿè·µæ–¹æ³•:</strong><br>
              â€¢ 2åˆ†ãƒ«ãƒ¼ãƒ«: ã¾ãšã¯2åˆ†ã ã‘å§‹ã‚ã‚‹<br>
              â€¢ éšœå£ã‚’æ¸›ã‚‰ã™: å§‹ã‚ã‚‹ã¾ã§ã®æ‰‹é †ã‚’æœ€å°ã«<br>
              â€¢ ç’°å¢ƒã‚’æº–å‚™: æ¬¡å›ã®ãŸã‚ã®æº–å‚™ã‚’ã—ã¦ãŠã
            </div>
          </div>
          <div class="law-card" data-law="4">
            <div class="law-number">4</div>
            <div class="law-title">æº€è¶³ã§ãã‚‹ã‚‚ã®ã«</div>
            <div class="law-desc">Make it Satisfying</div>
            <div class="law-detail">
              <strong>å®Ÿè·µæ–¹æ³•:</strong><br>
              â€¢ å³åº§ã®å ±é…¬: å®Œäº†ã—ãŸã‚‰å°ã•ãªã”è¤’ç¾ã‚’<br>
              â€¢ é€²æ—ã®å¯è¦–åŒ–: ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’è¨˜éŒ²ã™ã‚‹<br>
              â€¢ ã€Œä½•ã‚‚ã—ãªã„ã€ã‚’é¿ã‘ã‚‹: 2æ—¥é€£ç¶šã‚µãƒœã‚‰ãªã„
            </div>
          </div>
        </div>
      </div>

      <!-- Insights -->
      <div class="insight-section">
        <div class="insight-title">
          <span>ğŸ’¡</span> ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
        </div>
        <ul class="insight-list" id="insightList">
          <li><span>ğŸ¯</span> <span>æ¯æ—¥1%ã®æˆé•·ã‚’365æ—¥ç¶šã‘ã‚‹ã¨ã€ç´„37.8å€ã«ãªã‚Šã¾ã™</span></li>
          <li><span>âš ï¸</span> <span>é€†ã«æ¯æ—¥1%è¡°é€€ã™ã‚‹ã¨ã€1å¹´å¾Œã«ã¯åˆæœŸå€¤ã®ç´„3%ã¾ã§è½ã¡ã¾ã™</span></li>
          <li><span>ğŸ”‘</span> <span>é‡è¦ãªã®ã¯ã€Œç¶™ç¶šã€ã€‚ä¸€åº¦ã«ãŸãã•ã‚“ã‚ˆã‚Šã€æ¯æ—¥å°‘ã—ãšã¤ã€‚</span></li>
        </ul>
      </div>

      <!-- Calendar -->
      <div class="concept-section">
        <div class="concept-title">
          <span>ğŸ“…</span> Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ç¿’æ…£ã‚’ç®¡ç†
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 20px;">
          æ¯æ—¥ã®ç¿’æ…£ã‚’Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç™»éŒ²ã—ã¦ã€è¤‡åˆ©ã®åŠ›ã‚’å®Ÿæ„Ÿã—ã¾ã—ã‚‡ã†ã€‚
        </p>

        <div class="input-section" style="margin-bottom: 20px;">
          <div class="input-group">
            <div class="input-group-title">
              <span>âœï¸</span> äºˆå®šã®å†…å®¹
            </div>
            <div class="input-field">
              <label for="calendarTitle">äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ« <span style="color: var(--text-secondary); font-weight: 400; font-size: 11px; opacity: 0.6;">(è‡ªåˆ†ã®ç¿’æ…£ã«åˆã‚ã›ã¦å¤‰æ›´å¯)</span></label>
              <input type="text" id="calendarTitle" value="1%æˆé•·ã™ã‚‹æ™‚é–“" placeholder="ä¾‹: èª­æ›¸ã€é‹å‹•ã€å­¦ç¿’">
            </div>
            <div class="input-field">
              <label for="calendarDescription">èª¬æ˜ï¼ˆä»»æ„ï¼‰</label>
              <textarea id="calendarDescription" rows="8" style="width: 100%; padding: 12px 15px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 14px; font-family: inherit; background: var(--card-bg); color: var(--text-primary); resize: vertical;"></textarea>
            </div>
          </div>

          <div class="input-group">
            <div class="input-group-title">
              <span>â°</span> æ™‚é–“è¨­å®š
            </div>
            <div class="input-field">
              <label for="calendarStartTime">é–‹å§‹æ™‚åˆ»</label>
              <input type="time" id="calendarStartTime" value="07:00">
            </div>
            <div class="input-field">
              <label for="calendarDuration">äºˆå®šã®é•·ã•</label>
              <select id="calendarDuration">
                <option value="15">15åˆ†</option>
                <option value="30" selected>30åˆ†</option>
                <option value="45">45åˆ†</option>
                <option value="60">1æ™‚é–“</option>
                <option value="90">1æ™‚é–“30åˆ†</option>
                <option value="120">2æ™‚é–“</option>
              </select>
            </div>
          </div>

          <div class="input-group">
            <div class="input-group-title">
              <span>ğŸ“†</span> æœŸé–“è¨­å®š
            </div>
            <div class="input-field">
              <label for="calendarStartDate">é–‹å§‹æ—¥</label>
              <input type="date" id="calendarStartDate">
            </div>
            <div class="input-field">
              <label for="calendarEndDate">çµ‚äº†æ—¥</label>
              <input type="date" id="calendarEndDate">
            </div>
          </div>
        </div>

        <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <span>ğŸ”—</span>
            <span style="font-weight: 600; font-size: 14px;">ç”Ÿæˆã•ã‚ŒãŸURL</span>
          </div>
          <div id="calendarUrlDisplay" style="word-break: break-all; font-size: 12px; color: var(--text-secondary); max-height: 60px; overflow-y: auto;">
            URLãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
          </div>
        </div>

        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button class="btn btn-primary" id="generateCalendarUrl" style="flex: 1; min-width: 150px;">
            <span>ğŸ”—</span> URLã‚’ç”Ÿæˆ
          </button>
          <button class="btn btn-secondary" id="openCalendarUrl" style="flex: 1; min-width: 150px;">
            <span>ğŸ“…</span> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§é–‹ã
          </button>
          <button class="btn btn-outline" id="copyCalendarUrl" style="flex: 1; min-width: 150px;">
            <span>ğŸ“‹</span> ã‚³ãƒ”ãƒ¼
          </button>
        </div>
      </div>

      <!-- Share -->
      <div class="share-section">
        <button class="share-btn" id="shareTwitterBtn">
          <span>ğŸ¦</span> Twitterã§ã‚·ã‚§ã‚¢
        </button>
        <button class="share-btn" id="copyResultBtn">
          <span>ğŸ“‹</span> çµæœã‚’ã‚³ãƒ”ãƒ¼
        </button>
      </div>

      <div class="action-buttons">
        <button class="btn btn-outline" id="resetSkillBtn">
          <span>ğŸ”„</span> ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
    </div>

    <!-- è³‡ç”£é‹ç”¨ã‚¿ãƒ– -->
    <div class="tab-content" id="assetTab">
      <div class="input-section">
        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ’°</span> åˆæœŸæŠ•è³‡
          </div>
          <div class="input-field">
            <label for="principal">å…ƒæœ¬ï¼ˆåˆæœŸæŠ•è³‡é¡ï¼‰</label>
            <div class="input-with-unit">
              <input type="number" id="principal" value="1000000" min="0" step="10000">
              <span class="input-unit">å††</span>
            </div>
          </div>
          <div class="input-field">
            <label for="monthly">æ¯æœˆã®ç©ç«‹é¡</label>
            <div class="input-with-unit">
              <input type="number" id="monthly" value="30000" min="0" step="1000">
              <span class="input-unit">å††</span>
            </div>
          </div>
        </div>

        <div class="input-group">
          <div class="input-group-title">
            <span>ğŸ“…</span> é‹ç”¨æ¡ä»¶
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>å¹´åˆ©ï¼ˆåˆ©å›ã‚Šï¼‰</label>
              <span class="slider-value" id="assetRateValue">5%</span>
            </div>
            <input type="range" class="slider-input" id="assetRate" value="5" min="0.1" max="15" step="0.1">
          </div>
          <div class="slider-field">
            <div class="slider-header">
              <label>é‹ç”¨æœŸé–“</label>
              <span class="slider-value" id="assetYearsValue">20å¹´</span>
            </div>
            <input type="range" class="slider-input" id="assetYears" value="20" min="1" max="50" step="1">
          </div>
          <div class="input-field">
            <label for="frequency">è¤‡åˆ©è¨ˆç®—ã®é »åº¦</label>
            <select id="frequency">
              <option value="1">å¹´1å›</option>
              <option value="12" selected>æ¯æœˆ</option>
            </select>
          </div>
        </div>
      </div>

      <button class="calculate-btn" id="calculateAssetBtn">
        <span>ğŸ“Š</span> ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
      </button>

      <div class="results-grid" id="assetResults">
        <div class="result-card highlight">
          <div class="result-icon">ğŸ’</div>
          <div class="result-value" id="finalAmount">0å††</div>
          <div class="result-label">æœ€çµ‚è³‡ç”£é¡</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ’µ</div>
          <div class="result-value" id="totalInvested">0å††</div>
          <div class="result-label">ç·æŠ•è³‡é¡</div>
        </div>
        <div class="result-card growth">
          <div class="result-icon">ğŸ“ˆ</div>
          <div class="result-value" id="totalInterest">0å††</div>
          <div class="result-label">é‹ç”¨ç›Š</div>
        </div>
        <div class="result-card">
          <div class="result-icon">ğŸ¯</div>
          <div class="result-value" id="returnRate">0%</div>
          <div class="result-label">åç›Šç‡</div>
        </div>
      </div>

      <div class="chart-section">
        <div class="chart-title">
          <span>ğŸ“‰</span> è³‡ç”£æ¨ç§»ã‚°ãƒ©ãƒ•
        </div>
        <div class="chart-container">
          <canvas id="assetChart"></canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-color" style="background: #3498db;"></div>
            <span>ç·è³‡ç”£é¡</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #2ecc71;"></div>
            <span>æŠ•è³‡å…ƒæœ¬</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>é‹ç”¨ç›Š</span>
          </div>
        </div>
      </div>

      <div class="table-section">
        <div class="table-title">
          <span>ğŸ“‹ å¹´æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿</span>
          <button class="btn btn-outline" id="exportCsvBtn" style="padding: 8px 16px; font-size: 14px;">
            <span>ğŸ’¾</span> CSV
          </button>
        </div>
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>å¹´</th>
                <th>å¹´åˆæ®‹é«˜</th>
                <th>ç©ç«‹é¡</th>
                <th>åˆ©æ¯</th>
                <th>å¹´æœ«æ®‹é«˜</th>
              </tr>
            </thead>
            <tbody id="assetTableBody"></tbody>
          </table>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-secondary" id="copyAssetResultBtn">
          <span>ğŸ“‹</span> çµæœã‚’ã‚³ãƒ”ãƒ¼
        </button>
        <button class="btn btn-outline" id="resetAssetBtn">
          <span>ğŸ”„</span> ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
    </div>

  </div>

  <div class="toast" id="toast"></div>

  <script>
    class CompoundGrowthApp {
        constructor() {
            this.quotes = [
                { text: "æ¯æ—¥1%è‰¯ããªã‚Œã°ã€1å¹´å¾Œã«ã¯37å€è‰¯ããªã‚‹ã€‚<br>æ¯æ—¥1%æ‚ªããªã‚Œã°ã€1å¹´å¾Œã«ã¯ã»ã¼ã‚¼ãƒ­ã«ãªã‚‹ã€‚", source: "James Clearã€Atomic Habitsã€" },
                { text: "ç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€‚", source: "James Clear" },
                { text: "ç›®æ¨™ã«å±Šã‹ãªã„ã®ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®ã›ã„ã ã€‚", source: "Atomic Habits" },
                { text: "å‹è€…ã¨æ•—è€…ã®å·®ã¯ã€ç›®æ¨™ã§ã¯ãªãä»•çµ„ã¿ã«ã‚ã‚‹ã€‚", source: "James Clear" },
                { text: "ã‚ãªãŸã¯ç›®æ¨™ã®ãƒ¬ãƒ™ãƒ«ã«åˆ°é”ã™ã‚‹ã®ã§ã¯ãªã„ã€‚<br>ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¬ãƒ™ãƒ«ã«è½ã¡ç€ãã®ã ã€‚", source: "Atomic Habits" },
                { text: "è¡Œå‹•ã‚’ç¹°ã‚Šè¿”ã™ãŸã³ã«ã€ãã®äººã«ãªã£ã¦ã„ãã€‚", source: "James Clear" },
                { text: "æœ€ã‚‚å®Ÿè¡Œã—ã‚„ã™ã„ç¿’æ…£ãŒã€æœ€ã‚‚ç¶šãç¿’æ…£ã§ã‚ã‚‹ã€‚", source: "Atomic Habits" },
                { text: "2æ—¥é€£ç¶šã§ã‚µãƒœã‚‹ãªã€‚", source: "Atomic Habits" },
                { text: "ç’°å¢ƒã¯ã—ã°ã—ã°æ„å¿—åŠ›ã«å‹ã‚‹ã€‚", source: "James Clear" },
                { text: "å¤‰ã‚ã‚ŠãŸã‘ã‚Œã°ã€ãªã‚ŠãŸã„è‡ªåˆ†ã‚’æ¼”ã˜ã‚ã€‚", source: "Atomic Habits" }
            ];
            this.motivationalMessages = [
                "ä»Šæ—¥ã®1%ãŒã€1å¹´å¾Œã®37å€ã‚’ä½œã‚‹ã€‚ã•ã‚ã€å§‹ã‚ã‚ˆã†ã€‚",
                "æ˜¨æ—¥ã‚ˆã‚Š1%ã ã‘è‰¯ããªã‚Œã€‚ãã‚Œã ã‘ã§ã„ã„ã€‚",
                "å®Œç’§ã‚’ç›®æŒ‡ã™ãªã€‚ç¶™ç¶šã‚’ç›®æŒ‡ã›ã€‚",
                "ä»Šæ—¥ã‚µãƒœã‚Œã°ã€æ˜æ—¥ã®è‡ªåˆ†ãŒè‹¦ã—ã‚€ã€‚",
                "å°ã•ãªä¸€æ­©ã§ã‚‚ã€è¸ã¿å‡ºã—ãŸè€…ã ã‘ãŒå‰ã«é€²ã‚ã‚‹ã€‚",
                "æ‰èƒ½ã¯è¨€ã„è¨³ã«ãªã‚‰ãªã„ã€‚ç¿’æ…£ãŒã™ã¹ã¦ã‚’æ±ºã‚ã‚‹ã€‚",
                "ã‚„ã‚‹æ°—ãŒãªãã¦ã‚‚ã€ã‚„ã‚Œã€‚ç¿’æ…£ã¨ã¯ãã†ã„ã†ã‚‚ã®ã ã€‚",
                "å¤±æ•—ã—ã¦ã‚‚ã€ã¾ãŸå§‹ã‚ã‚Œã°ã„ã„ã€‚è«¦ã‚ãªã‘ã‚Œã°è² ã‘ã˜ã‚ƒãªã„ã€‚",
                "ä»Šã“ã®ç¬é–“ãŒã€äººç”Ÿã§ä¸€ç•ªè‹¥ã„ã€‚å§‹ã‚ã‚‹ãªã‚‰ä»Šã ã€‚",
                "æˆé•·ã¯è¦‹ãˆãªã„ã€‚ã§ã‚‚ç¢ºå®Ÿã«èµ·ãã¦ã„ã‚‹ã€‚ä¿¡ã˜ã¦ç¶šã‘ã‚ã€‚",
                "ãƒ—ãƒ­ã¨ã‚¢ãƒã®å·®ã¯ã€ã‚„ã‚‹æ°—ãŒãªã„æ—¥ã«ã‚‚ã‚„ã‚‹ã‹ã©ã†ã‹ã€‚",
                "1å¹´å¾Œã€ä»Šæ—¥ã‚’æŒ¯ã‚Šè¿”ã£ã¦æ„Ÿè¬ã™ã‚‹è‡ªåˆ†ã«ãªã‚Œã€‚"
            ];
            this.currentQuoteIndex = 0;
            this.state = {
                currentTab: 'skill',
                skillChart: null,
                assetChart: null,
                comparisonChart: null,
                previousMultiple: 1,
                isDarkMode: false
            };

            this.init();
        }

        init() {
            this.loadTheme();
            this.setupTabListeners();
            this.setupSkillListeners();
            this.setupAssetListeners();
            this.setupCalendarListeners();
            this.setupQuoteRotation();
            this.setupThemeToggle();
            this.setupComparison();
            this.setupLawCards();
            this.setupShareButtons();
            this.setupTimemachineDismiss();
            this.setupConceptToggle();
            this.calculateSkillGrowth();
            this.calculateAssetGrowth();
            this.drawValleyChart();
        }

        loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = 'â˜€ï¸';
                this.state.isDarkMode = true;
            }
        }

        setupThemeToggle() {
            document.getElementById('themeToggle').addEventListener('click', () => {
                this.state.isDarkMode = !this.state.isDarkMode;
                if (this.state.isDarkMode) {
                    document.body.setAttribute('data-theme', 'dark');
                    document.getElementById('themeToggle').textContent = 'â˜€ï¸';
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.removeAttribute('data-theme');
                    document.getElementById('themeToggle').textContent = 'ğŸŒ™';
                    localStorage.setItem('theme', 'light');
                }
                this.drawValleyChart();
            });
        }

        setupQuoteRotation() {
            document.getElementById('quoteBanner').addEventListener('click', () => {
                this.currentQuoteIndex = (this.currentQuoteIndex + 1) % this.quotes.length;
                const quote = this.quotes[this.currentQuoteIndex];
                document.getElementById('quoteText').innerHTML = quote.text;
                document.getElementById('quoteSource').textContent = 'â€” ' + quote.source;
            });
        }

        setupComparison() {
            const toggle = document.getElementById('comparisonToggle');
            const content = document.getElementById('comparisonContent');

            toggle.addEventListener('click', () => {
                toggle.classList.toggle('active');
                content.classList.toggle('active');
                toggle.textContent = toggle.classList.contains('active') ? 'æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã‚’OFF' : 'æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã‚’ON';
            });

            ['compRateA', 'compRateB'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => this.updateComparison());
            });
            this.updateComparison();
        }

        updateComparison() {
            const rateA = parseFloat(document.getElementById('compRateA').value);
            const rateB = parseFloat(document.getElementById('compRateB').value);

            document.getElementById('compRateAValue').textContent = rateA + '%';
            document.getElementById('compRateBValue').textContent = rateB + '%';

            const multipleA = Math.pow(1 + rateA / 100, 365);
            const multipleB = Math.pow(1 + rateB / 100, 365);

            document.getElementById('compResultA').textContent = multipleA.toFixed(1) + 'x';
            document.getElementById('compResultB').textContent = multipleB.toFixed(1) + 'x';

            const rateDiff = Math.abs(rateA - rateB);
            document.querySelector('.comparison-diff-label').textContent = `1æ—¥ãŸã£ãŸ${rateDiff.toFixed(1)}%ã®å·®ãŒ1å¹´å¾Œã«ã¯...`;

            const diff = Math.abs(multipleA - multipleB);
            document.getElementById('compDiff').textContent = diff.toFixed(1) + 'å€ã®å·®';

            this.updateComparisonChart(rateA / 100, rateB / 100);
        }

        updateComparisonChart(rateA, rateB) {
            const canvas = document.getElementById('comparisonChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (this.state.comparisonChart) this.state.comparisonChart.destroy();

            const labels = [];
            const dataA = [];
            const dataB = [];
            const days = 365;
            const step = Math.max(1, Math.floor(days / 50));

            for (let i = 0; i <= days; i += step) {
                labels.push(i + 'æ—¥');
                dataA.push(100 * Math.pow(1 + rateA, i));
                dataB.push(100 * Math.pow(1 + rateB, i));
            }

            if (typeof Chart !== 'undefined') {
                this.state.comparisonChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            { label: 'ã‚·ãƒŠãƒªã‚ªA', data: dataA, borderColor: '#3498db', backgroundColor: 'rgba(52,152,219,0.1)', fill: true, tension: 0.4, pointRadius: 1 },
                            { label: 'ã‚·ãƒŠãƒªã‚ªB', data: dataB, borderColor: '#2ecc71', backgroundColor: 'rgba(46,204,113,0.1)', fill: true, tension: 0.4, pointRadius: 1 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: true, position: 'top' } },
                        scales: { y: { beginAtZero: true, ticks: { callback: (v) => this.formatNumber(v) } } }
                    }
                });
            }
        }

        setupLawCards() {
            document.querySelectorAll('.law-card').forEach(card => {
                card.addEventListener('click', () => {
                    card.classList.toggle('expanded');
                });
            });
        }

        setupTimemachineDismiss() {
            const section = document.getElementById('timemachineSection');
            if (section) {
                section.addEventListener('click', () => {
                    section.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    section.style.opacity = '0';
                    section.style.transform = 'scale(0.95)';
                    setTimeout(() => section.remove(), 300);
                    this.showToast('éå»ã«ã¯æˆ»ã‚Œã¾ã›ã‚“ã€‚ä»Šæ—¥ã‹ã‚‰ã¯ã˜ã‚ã‚‹ã—ã‹ãªã„ã§ã™ã€‚', 5000);
                });
            }
        }

        setupConceptToggle() {
            document.querySelectorAll('.concept-card, .example-card').forEach(card => {
                const detail = card.querySelector('.concept-card-detail, .example-card-detail');
                if (detail) {
                    detail.style.maxHeight = '0';
                    detail.style.overflow = 'hidden';
                    detail.style.opacity = '0';
                    detail.style.transition = 'max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease, padding 0.3s ease';
                    detail.style.display = 'block';
                    detail.style.marginTop = '0';
                    detail.style.paddingTop = '0';

                    card.addEventListener('mouseenter', () => {
                        detail.style.maxHeight = '300px';
                        detail.style.opacity = '1';
                        detail.style.marginTop = '15px';
                        detail.style.paddingTop = '15px';
                    });

                    card.addEventListener('mouseleave', () => {
                        detail.style.maxHeight = '0';
                        detail.style.opacity = '0';
                        detail.style.marginTop = '0';
                        detail.style.paddingTop = '0';
                    });
                }
            });
        }

        setupShareButtons() {
            document.getElementById('shareTwitterBtn').addEventListener('click', () => {
                const rate = document.getElementById('skillRate').value;
                const days = document.getElementById('skillDays').value;
                const multiple = document.getElementById('growthMultiple').textContent;
                const text = `æ¯æ—¥${rate}%æˆé•·ã‚’${days}æ—¥ç¶šã‘ã‚‹ã¨${multiple}ã«ãªã‚‹ï¼\n\nã€Œç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€\n\n#è¤‡åˆ©ã®åŠ› #AtomicHabits`;
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
            });

            document.getElementById('copyResultBtn').addEventListener('click', () => this.copySkillResults());
        }

        setupTabListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    this.switchTab(tab);
                });
            });
        }

        switchTab(tab) {
            this.state.currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tab') === tab);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + 'Tab').classList.add('active');

            if (tab === 'skill') {
                this.calculateSkillGrowth();
                this.drawValleyChart();
            } else {
                this.calculateAssetGrowth();
            }
        }

        setupSkillListeners() {
            const skillRate = document.getElementById('skillRate');
            const skillDays = document.getElementById('skillDays');

            skillRate.addEventListener('input', () => {
                document.getElementById('skillRateValue').textContent = skillRate.value + '%';
                this.calculateSkillGrowth();
            });

            skillDays.addEventListener('input', () => {
                document.getElementById('skillDaysValue').textContent = skillDays.value + 'æ—¥';
                this.calculateSkillGrowth();
            });

            document.getElementById('initialSkill').addEventListener('input', () => this.calculateSkillGrowth());

            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    this.applyPreset(btn.getAttribute('data-preset'));
                    document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            document.getElementById('resetSkillBtn').addEventListener('click', () => this.resetSkill());
        }

        applyPreset(preset) {
            const presets = {
                'daily1': { rate: 1.0, days: 365 },
                'daily05': { rate: 0.5, days: 365 },
                'daily01': { rate: 0.1, days: 365 },
                'decline': { rate: -1.0, days: 365 },
                'weekly': { rate: 5.0, days: 52 },
                'sprint': { rate: 2.0, days: 30 }
            };

            const p = presets[preset];
            if (p) {
                document.getElementById('skillRate').value = p.rate;
                document.getElementById('skillDays').value = p.days;
                document.getElementById('skillRateValue').textContent = p.rate + '%';
                document.getElementById('skillDaysValue').textContent = p.days + 'æ—¥';
                this.calculateSkillGrowth();
            }
        }

        calculateSkillGrowth() {
            const rate = parseFloat(document.getElementById('skillRate').value) / 100;
            const days = parseInt(document.getElementById('skillDays').value);
            const initial = parseFloat(document.getElementById('initialSkill').value) || 100;

            const finalSkill = initial * Math.pow(1 + rate, days);
            const growthMultiple = finalSkill / initial;
            const totalGrowth = finalSkill - initial;
            const doublingTime = rate > 0 ? Math.ceil(72 / (rate * 100)) : 'âˆ';

            // Animate values
            this.animateValue('finalSkill', this.formatNumber(finalSkill));
            if (growthMultiple < 1) {
                this.animateValue('growthMultiple', (growthMultiple * 100).toFixed(1) + '%ã«æ¸›å°‘');
            } else {
                this.animateValue('growthMultiple', growthMultiple.toFixed(1) + 'x');
            }
            this.animateValue('totalGrowth', (totalGrowth >= 0 ? '+' : '') + this.formatNumber(totalGrowth));
            document.getElementById('doublingTime').textContent = doublingTime === 'âˆ' ? 'âˆ' : doublingTime + 'æ—¥';

            // Time machine
            this.updateTimeMachine(rate, initial);

            this.updateInsights(rate, days, growthMultiple);
            this.updateSkillChart(rate, days, initial);
        }

        animateValue(elementId, newValue) {
            const el = document.getElementById(elementId);
            el.classList.add('animating');
            el.textContent = newValue;
            setTimeout(() => el.classList.remove('animating'), 300);
        }

        updateTimeMachine(rate, initial) {
            if (rate <= 0) {
                document.getElementById('tm30').textContent = '-';
                document.getElementById('tm90').textContent = '-';
                document.getElementById('tm365').textContent = '-';
                document.getElementById('tmFuture').textContent = '-';
                return;
            }

            const tm30 = initial * Math.pow(1 + rate, 30);
            const tm90 = initial * Math.pow(1 + rate, 90);
            const tm365 = initial * Math.pow(1 + rate, 365);
            const tmFuture = initial * Math.pow(1 + rate, 365);

            document.getElementById('tm30').textContent = (tm30 / initial).toFixed(1) + 'x';
            document.getElementById('tm90').textContent = (tm90 / initial).toFixed(1) + 'x';
            document.getElementById('tm365').textContent = (tm365 / initial).toFixed(1) + 'x';
            document.getElementById('tmFuture').textContent = (tmFuture / initial).toFixed(1) + 'x';
        }

        updateInsights(rate, days, multiple) {
            const insights = [];

            if (rate > 0) {
                insights.push({
                    icon: 'ğŸ¯',
                    text: `æ¯æ—¥${(rate * 100).toFixed(1)}%ã®æˆé•·ã‚’${days}æ—¥ç¶šã‘ã‚‹ã¨ã€ç´„${multiple.toFixed(1)}å€ã«ãªã‚Šã¾ã™`
                });

                const halfwayMultiple = Math.pow(1 + rate, Math.floor(days / 2));
                insights.push({
                    icon: 'ğŸ“Š',
                    text: `${Math.floor(days / 2)}æ—¥ç›®ã§${halfwayMultiple.toFixed(1)}å€ï¼ˆæœ€çµ‚ã®${(halfwayMultiple / multiple * 100).toFixed(0)}%ï¼‰â€” ã“ã‚ŒãŒã€Œå¤±æœ›ã®è°·ã€`
                });
            } else if (rate < 0) {
                insights.push({
                    icon: 'ğŸ“‰',
                    text: `æ¯æ—¥${Math.abs(rate * 100).toFixed(1)}%è¡°é€€ã™ã‚‹ã¨ã€${days}æ—¥å¾Œã«ã¯${(multiple * 100).toFixed(1)}%ã«`
                });
            }

            insights.push({
                icon: 'ğŸ”‘',
                text: 'ã€Œç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€â€” å°ã•ãªé¸æŠãŒæœªæ¥ã‚’å½¢ä½œã‚‹'
            });

            document.getElementById('insightList').innerHTML = insights.map(i =>
                `<li><span>${i.icon}</span> <span>${i.text}</span></li>`
            ).join('');
        }

        drawValleyChart() {
            const canvas = document.getElementById('valleyChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.parentElement.clientWidth - 40;
            const height = 160;
            canvas.width = width;
            canvas.height = height;

            ctx.clearRect(0, 0, width, height);

            const padding = 30;
            const graphWidth = width - padding * 2;
            const graphHeight = height - padding * 2;
            const isDark = this.state.isDarkMode;

            ctx.strokeStyle = isDark ? '#2a2a4a' : '#e0e6ed';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();

            ctx.strokeStyle = isDark ? '#555' : '#bdc3c7';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, padding);
            ctx.stroke();

            ctx.strokeStyle = '#9b59b6';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath();
            for (let i = 0; i <= 50; i++) {
                const x = padding + (graphWidth * i / 50);
                const progress = i / 50;
                const expValue = Math.pow(1.01, progress * 365) - 1;
                const normalizedValue = expValue / (Math.pow(1.01, 365) - 1);
                const y = height - padding - (normalizedValue * graphHeight);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            ctx.fillStyle = 'rgba(231, 76, 60, 0.1)';
            ctx.beginPath();
            ctx.moveTo(padding + graphWidth * 0.1, height - padding);
            ctx.lineTo(padding + graphWidth * 0.5, height - padding);
            ctx.lineTo(padding + graphWidth * 0.5, height - padding - graphHeight * 0.2);
            ctx.lineTo(padding + graphWidth * 0.1, height - padding - graphHeight * 0.05);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = isDark ? '#a0a0a0' : '#7f8c8d';
            ctx.font = '11px Noto Sans JP';
            ctx.textAlign = 'center';
            ctx.fillText('æ™‚é–“', width / 2, height - 5);

            ctx.fillStyle = '#e74c3c';
            ctx.font = '10px Noto Sans JP';
            ctx.fillText('å¤±æœ›ã®è°·', padding + graphWidth * 0.3, height - padding - graphHeight * 0.05);
        }

        updateSkillChart(rate, days, initial) {
            const ctx = document.getElementById('skillChart').getContext('2d');
            if (this.state.skillChart) this.state.skillChart.destroy();

            const labels = [];
            const compoundData = [];
            const linearData = [];
            const step = Math.max(1, Math.floor(days / 50));
            const finalCompound = initial * Math.pow(1 + rate, days);

            for (let i = 0; i <= days; i += step) {
                labels.push(i + 'æ—¥');
                compoundData.push(initial * Math.pow(1 + rate, i));
                linearData.push(initial + (finalCompound - initial) * (i / days));
            }

            if (typeof Chart !== 'undefined') {
                this.state.skillChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            { label: 'è¤‡åˆ©æˆé•·', data: compoundData, borderColor: '#9b59b6', backgroundColor: 'rgba(155,89,182,0.1)', fill: true, tension: 0.4, pointRadius: 2 },
                            { label: 'ç·šå½¢æˆé•·', data: linearData, borderColor: '#bdc3c7', backgroundColor: 'rgba(189,195,199,0.1)', fill: true, tension: 0, pointRadius: 0, borderDash: [5, 5] }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => ctx.dataset.label + ': ' + this.formatNumber(ctx.raw) } } },
                        scales: { y: { beginAtZero: true, ticks: { callback: (v) => this.formatNumber(v) } } }
                    }
                });
            }
        }

        setupAssetListeners() {
            document.getElementById('assetRate').addEventListener('input', (e) => {
                document.getElementById('assetRateValue').textContent = e.target.value + '%';
                this.calculateAssetGrowth();
            });
            document.getElementById('assetYears').addEventListener('input', (e) => {
                document.getElementById('assetYearsValue').textContent = e.target.value + 'å¹´';
                this.calculateAssetGrowth();
            });
            ['principal', 'monthly', 'frequency'].forEach(id => {
                document.getElementById(id).addEventListener('input', () => this.calculateAssetGrowth());
            });
            document.getElementById('calculateAssetBtn').addEventListener('click', () => {
                this.calculateAssetGrowth();
                this.showToast('è¨ˆç®—å®Œäº†');
            });
            document.getElementById('copyAssetResultBtn').addEventListener('click', () => this.copyAssetResults());
            document.getElementById('resetAssetBtn').addEventListener('click', () => this.resetAsset());
            document.getElementById('exportCsvBtn').addEventListener('click', () => this.exportCSV());
        }

        setupCalendarListeners() {
            // Set default dates
            const today = new Date();
            const endDate = new Date(today);
            endDate.setFullYear(endDate.getFullYear() + 1);

            document.getElementById('calendarStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('calendarEndDate').value = endDate.toISOString().split('T')[0];

            // Set random motivational message
            this.updateCalendarDescription();

            document.getElementById('generateCalendarUrl').addEventListener('click', () => this.generateCalendarUrl());
            document.getElementById('openCalendarUrl').addEventListener('click', () => this.openCalendarUrl());
            document.getElementById('copyCalendarUrl').addEventListener('click', () => this.copyCalendarUrl());
        }

        updateCalendarDescription() {
            const randomMessage = this.motivationalMessages[Math.floor(Math.random() * this.motivationalMessages.length)];
            const description = `ã€${randomMessage}ã€‘

ã€é™ç•Œçš„ç·´ç¿’ã‚’ç¶šã‘ã‚‹ãŸã‚ã®10+1ã®ãƒ«ãƒ¼ãƒ«ã€‘
â€¢ ã„ã¤ã‚‚è‡ªåˆ†ã®èƒ½åŠ›ã‚ˆã‚Šå°‘ã—é›£ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ç¶šã‘ã‚‹
â€¢ ã€Œã“ã‚Œã§ååˆ†ã€ã¨ã„ã†è€ƒãˆã‚’æŒãŸãªã„
â€¢ å€‹äººã§ã®é›†ä¸­ç·´ç¿’æ™‚é–“ã‚’ç¢ºä¿ã™ã‚‹
â€¢ è‡ªå·±ã®å¼±ç‚¹ã‚’ç‰¹å®šã—ã€å…‹æœã™ã‚‹ãŸã‚ã®ç·´ç¿’ã‚’ç¶™ç¶šçš„ã«è¡Œã†
â€¢ ç·´ç¿’ã‚’å˜ãªã‚‹ã€Œæ¥½ã—ã¿ã€ã¨ã—ã¦æ‰ãˆãªã„
â€¢ é›†ä¸­åŠ›ã®é™ç•Œã‚’èªè­˜ã—ã€ãã‚Œã‚’è¶…ãˆãŸã‚‰ä¼‘æ†©ã‚’å–ã‚‹
â€¢ åœæ»æœŸã«ã¯ç·´ç¿’æ–¹æ³•ã®è¦‹ç›´ã—ã‚’è¡Œã†
â€¢ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ã‚’çŸ­ãã—ã€å³åº§ã«çµæœã‚„è©•ä¾¡ã‚’å¾—ã‚‹
â€¢ ä¸€æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ˜ç¢ºã«åŒºåˆ†ã‘ã™ã‚‹
â€¢ æ‰èƒ½ã¯è³ªã®é«˜ã„ç·´ç¿’ã®ç©ã¿é‡ã­ã«ã‚ˆã£ã¦å½¢æˆã•ã‚Œã‚‹
â€¢ éå»ã«å­¦ã‚“ã ã“ã¨ã‚’æ‰‹æ”¾ã™å‹‡æ°—ã‚’æŒã¤ï¼ˆã‚¢ãƒ³ãƒ©ãƒ¼ãƒ³ï¼‰

ğŸ“Š è¤‡åˆ©è¨ˆç®—ãƒ„ãƒ¼ãƒ«: https://nwiizo.github.io/compound-interest/`;
            document.getElementById('calendarDescription').value = description;
        }

        generateCalendarUrl() {
            const title = document.getElementById('calendarTitle').value || '1%æˆé•·ã™ã‚‹æ™‚é–“';
            const description = document.getElementById('calendarDescription').value || '';
            const startTime = document.getElementById('calendarStartTime').value;
            const duration = parseInt(document.getElementById('calendarDuration').value);
            const startDate = document.getElementById('calendarStartDate').value;
            const endDate = document.getElementById('calendarEndDate').value;

            if (!startDate || !endDate) {
                this.showToast('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return null;
            }

            // Parse start time
            const [hours, minutes] = startTime.split(':').map(Number);

            // Create start datetime
            const start = new Date(startDate);
            start.setHours(hours, minutes, 0, 0);

            // Create end datetime
            const end = new Date(start);
            end.setMinutes(end.getMinutes() + duration);

            // Format dates for Google Calendar (YYYYMMDDTHHmmss)
            const formatDate = (d) => {
                return d.toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
            };

            // Format end date for recurrence (YYYYMMDD)
            const recurrenceEnd = endDate.replace(/-/g, '');

            // Build URL
            const params = new URLSearchParams({
                action: 'TEMPLATE',
                text: title,
                dates: `${formatDate(start)}/${formatDate(end)}`,
                details: description,
                recur: `RRULE:FREQ=DAILY;UNTIL=${recurrenceEnd}T235959Z`
            });

            const url = `https://calendar.google.com/calendar/render?${params.toString()}`;

            document.getElementById('calendarUrlDisplay').textContent = url;
            this.state.calendarUrl = url;
            this.showToast('URLã‚’ç”Ÿæˆã—ã¾ã—ãŸ');

            return url;
        }

        openCalendarUrl() {
            const url = this.state.calendarUrl || this.generateCalendarUrl();
            if (url) {
                window.open(url, '_blank');
            }
        }

        copyCalendarUrl() {
            const url = this.state.calendarUrl || this.generateCalendarUrl();
            if (url) {
                this.copyToClipboard(url);
            }
        }

        calculateAssetGrowth() {
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const monthly = parseFloat(document.getElementById('monthly').value) || 0;
            const annualRate = parseFloat(document.getElementById('assetRate').value) / 100;
            const years = parseInt(document.getElementById('assetYears').value) || 0;
            const frequency = parseInt(document.getElementById('frequency').value);

            const yearlyData = [];
            let balance = principal, totalInvested = principal, totalInterest = 0;
            const periodicRate = annualRate / frequency;
            const monthlyRatio = 12 / frequency;

            for (let year = 1; year <= years; year++) {
                const startBalance = balance;
                let yearlyInvestment = 0, yearlyInterest = 0;
                for (let p = 0; p < frequency; p++) {
                    const contrib = monthly * monthlyRatio;
                    balance += contrib;
                    yearlyInvestment += contrib;
                    totalInvested += contrib;
                    const interest = balance * periodicRate;
                    balance += interest;
                    yearlyInterest += interest;
                    totalInterest += interest;
                }
                yearlyData.push({ year, startBalance: Math.round(startBalance), investment: Math.round(yearlyInvestment), interest: Math.round(yearlyInterest), endBalance: Math.round(balance) });
            }

            document.getElementById('finalAmount').textContent = this.formatCurrency(Math.round(balance));
            document.getElementById('totalInvested').textContent = this.formatCurrency(Math.round(totalInvested));
            document.getElementById('totalInterest').textContent = this.formatCurrency(Math.round(totalInterest));
            document.getElementById('returnRate').textContent = (totalInvested > 0 ? ((balance - totalInvested) / totalInvested * 100).toFixed(1) : 0) + '%';

            this.updateAssetChart(yearlyData, principal);
            this.updateAssetTable(yearlyData);
            this.state.yearlyData = yearlyData;
            this.state.assetResults = { finalAmount: balance, totalInvested, totalInterest };
        }

        updateAssetChart(data, principal) {
            const ctx = document.getElementById('assetChart').getContext('2d');
            if (this.state.assetChart) this.state.assetChart.destroy();

            const labels = ['é–‹å§‹', ...data.map(d => d.year + 'å¹´')];
            const totals = [principal, ...data.map(d => d.endBalance)];
            const invested = [principal, ...data.map((_, i) => principal + data.slice(0, i + 1).reduce((s, d) => s + d.investment, 0))];
            const interests = [0, ...data.map((_, i) => data.slice(0, i + 1).reduce((s, d) => s + d.interest, 0))];

            if (typeof Chart !== 'undefined') {
                this.state.assetChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [
                            { label: 'ç·è³‡ç”£', data: totals, borderColor: '#3498db', backgroundColor: 'rgba(52,152,219,0.1)', fill: true, tension: 0.4 },
                            { label: 'å…ƒæœ¬', data: invested, borderColor: '#2ecc71', backgroundColor: 'rgba(46,204,113,0.1)', fill: true, tension: 0.4 },
                            { label: 'é‹ç”¨ç›Š', data: interests, borderColor: '#e74c3c', backgroundColor: 'rgba(231,76,60,0.1)', fill: true, tension: 0.4 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { callback: v => v >= 1e8 ? (v / 1e8).toFixed(1) + 'å„„' : v >= 1e4 ? (v / 1e4).toFixed(0) + 'ä¸‡' : v } } } }
                });
            }
        }

        updateAssetTable(data) {
            document.getElementById('assetTableBody').innerHTML = data.map((d, i) =>
                `<tr class="${i === data.length - 1 ? 'highlight-row' : ''}"><td>${d.year}å¹´</td><td>${this.formatCurrency(d.startBalance)}</td><td>${this.formatCurrency(d.investment)}</td><td>${this.formatCurrency(d.interest)}</td><td>${this.formatCurrency(d.endBalance)}</td></tr>`
            ).join('');
        }

        formatNumber(v) {
            if (Math.abs(v) >= 1e6) return (v / 1e6).toFixed(2) + 'M';
            if (Math.abs(v) >= 1e3) return (v / 1e3).toFixed(1) + 'K';
            return Math.round(v).toLocaleString();
        }

        formatCurrency(v) {
            if (v >= 1e8) return (v / 1e8).toFixed(2) + 'å„„å††';
            if (v >= 1e4) return Math.round(v / 1e4).toLocaleString() + 'ä¸‡å††';
            return v.toLocaleString() + 'å††';
        }

        copySkillResults() {
            const text = `ã€è¤‡åˆ©æˆé•·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‘\næˆé•·ç‡: ${document.getElementById('skillRate').value}%/æ—¥\næœŸé–“: ${document.getElementById('skillDays').value}æ—¥\næˆé•·å€ç‡: ${document.getElementById('growthMultiple').textContent}\n\nã€Œç¿’æ…£ã¯è‡ªå·±æ”¹å–„ã®è¤‡åˆ©ã§ã‚ã‚‹ã€â€” Atomic Habits`;
            this.copyToClipboard(text);
        }

        copyAssetResults() {
            const r = this.state.assetResults;
            if (!r) return;
            this.copyToClipboard(`ã€è¤‡åˆ©è¨ˆç®—çµæœã€‘\næœ€çµ‚è³‡ç”£é¡: ${this.formatCurrency(r.finalAmount)}\nç·æŠ•è³‡é¡: ${this.formatCurrency(r.totalInvested)}\né‹ç”¨ç›Š: ${this.formatCurrency(r.totalInterest)}`);
        }

        copyToClipboard(text) {
            navigator.clipboard?.writeText(text).then(() => this.showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ')).catch(() => this.showToast('ã‚³ãƒ”ãƒ¼å¤±æ•—'));
        }

        exportCSV() {
            const d = this.state.yearlyData;
            if (!d?.length) return;
            const csv = 'å¹´,å¹´åˆæ®‹é«˜,ç©ç«‹é¡,åˆ©æ¯,å¹´æœ«æ®‹é«˜\n' + d.map(r => `${r.year},${r.startBalance},${r.investment},${r.interest},${r.endBalance}`).join('\n');
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
            a.download = `compound_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            this.showToast('CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
        }

        resetSkill() {
            document.getElementById('skillRate').value = 1;
            document.getElementById('skillDays').value = 365;
            document.getElementById('initialSkill').value = 100;
            document.getElementById('skillRateValue').textContent = '1.0%';
            document.getElementById('skillDaysValue').textContent = '365æ—¥';
            document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-preset="daily1"]').classList.add('active');
            this.calculateSkillGrowth();
            this.showToast('ãƒªã‚»ãƒƒãƒˆå®Œäº†');
        }

        resetAsset() {
            document.getElementById('principal').value = 1000000;
            document.getElementById('monthly').value = 30000;
            document.getElementById('assetRate').value = 5;
            document.getElementById('assetYears').value = 20;
            document.getElementById('assetRateValue').textContent = '5%';
            document.getElementById('assetYearsValue').textContent = '20å¹´';
            this.calculateAssetGrowth();
            this.showToast('ãƒªã‚»ãƒƒãƒˆå®Œäº†');
        }

        showToast(msg, duration = 3000) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), duration);
        }
    }

    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
    script.onload = () => new CompoundGrowthApp();
    script.onerror = () => new CompoundGrowthApp();
    document.head.appendChild(script);
  </script>
</body>

</html>
